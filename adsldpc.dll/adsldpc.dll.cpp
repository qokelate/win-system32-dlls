#include <windows.h>
#include <shlwapi.h>

extern "C" {
extern void *ptr_ADSIAbandonSearch;
void *ptr_ADSIAbandonSearch = NULL;
extern void *ptr_ADSICloseDSObject;
void *ptr_ADSICloseDSObject = NULL;
extern void *ptr_ADSICloseSearchHandle;
void *ptr_ADSICloseSearchHandle = NULL;
extern void *ptr_ADSICreateDSObject;
void *ptr_ADSICreateDSObject = NULL;
extern void *ptr_ADSIDeleteDSObject;
void *ptr_ADSIDeleteDSObject = NULL;
extern void *ptr_ADSIExecuteSearch;
void *ptr_ADSIExecuteSearch = NULL;
extern void *ptr_ADSIFreeColumn;
void *ptr_ADSIFreeColumn = NULL;
extern void *ptr_ADSIGetColumn;
void *ptr_ADSIGetColumn = NULL;
extern void *ptr_ADSIGetFirstRow;
void *ptr_ADSIGetFirstRow = NULL;
extern void *ptr_ADSIGetNextColumnName;
void *ptr_ADSIGetNextColumnName = NULL;
extern void *ptr_ADSIGetNextRow;
void *ptr_ADSIGetNextRow = NULL;
extern void *ptr_ADSIGetObjectAttributes;
void *ptr_ADSIGetObjectAttributes = NULL;
extern void *ptr_ADSIGetPreviousRow;
void *ptr_ADSIGetPreviousRow = NULL;
extern void *ptr_ADSIModifyRdn;
void *ptr_ADSIModifyRdn = NULL;
extern void *ptr_ADSIOpenDSObject;
void *ptr_ADSIOpenDSObject = NULL;
extern void *ptr_ADSIPrint;
void *ptr_ADSIPrint = NULL;
extern void *ptr_ADSISetObjectAttributes;
void *ptr_ADSISetObjectAttributes = NULL;
extern void *ptr_ADSISetSearchPreference;
void *ptr_ADSISetSearchPreference = NULL;
extern void *ptr_ADsAbandonSearch;
void *ptr_ADsAbandonSearch = NULL;
extern void *ptr_ADsCloseSearchHandle;
void *ptr_ADsCloseSearchHandle = NULL;
extern void *ptr_ADsCreateAttributeDefinition;
void *ptr_ADsCreateAttributeDefinition = NULL;
extern void *ptr_ADsCreateClassDefinition;
void *ptr_ADsCreateClassDefinition = NULL;
extern void *ptr_ADsCreateDSObject;
void *ptr_ADsCreateDSObject = NULL;
extern void *ptr_ADsCreateDSObjectExt;
void *ptr_ADsCreateDSObjectExt = NULL;
extern void *ptr_ADsDecodeBinaryData;
void *ptr_ADsDecodeBinaryData = NULL;
extern void *ptr_ADsDeleteAttributeDefinition;
void *ptr_ADsDeleteAttributeDefinition = NULL;
extern void *ptr_ADsDeleteClassDefinition;
void *ptr_ADsDeleteClassDefinition = NULL;
extern void *ptr_ADsDeleteDSObject;
void *ptr_ADsDeleteDSObject = NULL;
extern void *ptr_ADsEncodeBinaryData;
void *ptr_ADsEncodeBinaryData = NULL;
extern void *ptr_ADsEnumAttributes;
void *ptr_ADsEnumAttributes = NULL;
extern void *ptr_ADsEnumClasses;
void *ptr_ADsEnumClasses = NULL;
extern void *ptr_ADsExecuteSearch;
void *ptr_ADsExecuteSearch = NULL;
extern void *ptr_ADsFreeColumn;
void *ptr_ADsFreeColumn = NULL;
extern void *ptr_ADsGetColumn;
void *ptr_ADsGetColumn = NULL;
extern void *ptr_ADsGetFirstRow;
void *ptr_ADsGetFirstRow = NULL;
extern void *ptr_ADsGetLastError;
void *ptr_ADsGetLastError = NULL;
extern void *ptr_ADsGetNextColumnName;
void *ptr_ADsGetNextColumnName = NULL;
extern void *ptr_ADsGetNextRow;
void *ptr_ADsGetNextRow = NULL;
extern void *ptr_ADsGetObjectAttributes;
void *ptr_ADsGetObjectAttributes = NULL;
extern void *ptr_ADsGetPreviousRow;
void *ptr_ADsGetPreviousRow = NULL;
extern void *ptr_ADsHelperGetCurrentRowMessage;
void *ptr_ADsHelperGetCurrentRowMessage = NULL;
extern void *ptr_ADsObject;
void *ptr_ADsObject = NULL;
extern void *ptr_ADsSetLastError;
void *ptr_ADsSetLastError = NULL;
extern void *ptr_ADsSetObjectAttributes;
void *ptr_ADsSetObjectAttributes = NULL;
extern void *ptr_ADsSetSearchPreference;
void *ptr_ADsSetSearchPreference = NULL;
extern void *ptr_ADsWriteAttributeDefinition;
void *ptr_ADsWriteAttributeDefinition = NULL;
extern void *ptr_ADsWriteClassDefinition;
void *ptr_ADsWriteClassDefinition = NULL;
extern void *ptr_AdsTypeFreeAdsObjects;
void *ptr_AdsTypeFreeAdsObjects = NULL;
extern void *ptr_AdsTypeToLdapTypeCopyConstruct;
void *ptr_AdsTypeToLdapTypeCopyConstruct = NULL;
extern void *ptr_AdsTypeToLdapTypeCopyDNWithBinary;
void *ptr_AdsTypeToLdapTypeCopyDNWithBinary = NULL;
extern void *ptr_AdsTypeToLdapTypeCopyDNWithString;
void *ptr_AdsTypeToLdapTypeCopyDNWithString = NULL;
extern void *ptr_AdsTypeToLdapTypeCopyGeneralizedTime;
void *ptr_AdsTypeToLdapTypeCopyGeneralizedTime = NULL;
extern void *ptr_AdsTypeToLdapTypeCopyTime;
void *ptr_AdsTypeToLdapTypeCopyTime = NULL;
extern void *ptr_AllocADsMem;
void *ptr_AllocADsMem = NULL;
extern void *ptr_AllocADsStr;
void *ptr_AllocADsStr = NULL;
extern void *ptr_BerBvFree;
void *ptr_BerBvFree = NULL;
extern void *ptr_BerEncodingQuotaControl;
void *ptr_BerEncodingQuotaControl = NULL;
extern void *ptr_BuildADsParentPath;
void *ptr_BuildADsParentPath = NULL;
extern void *ptr_BuildADsParentPathFromObjectInfo;
void *ptr_BuildADsParentPathFromObjectInfo = NULL;
extern void *ptr_BuildADsParentPathFromObjectInfo2;
void *ptr_BuildADsParentPathFromObjectInfo2 = NULL;
extern void *ptr_BuildADsPathFromLDAPPath;
void *ptr_BuildADsPathFromLDAPPath = NULL;
extern void *ptr_BuildADsPathFromLDAPPath2;
void *ptr_BuildADsPathFromLDAPPath2 = NULL;
extern void *ptr_BuildADsPathFromParent;
void *ptr_BuildADsPathFromParent = NULL;
extern void *ptr_BuildLDAPPathFromADsPath;
void *ptr_BuildLDAPPathFromADsPath = NULL;
extern void *ptr_BuildLDAPPathFromADsPath2;
void *ptr_BuildLDAPPathFromADsPath2 = NULL;
extern void *ptr_ChangeSeparator;
void *ptr_ChangeSeparator = NULL;
extern void *ptr_Component;
void *ptr_Component = NULL;
extern void *ptr_ConvertSidToString;
void *ptr_ConvertSidToString = NULL;
extern void *ptr_ConvertSidToU2Trustee;
void *ptr_ConvertSidToU2Trustee = NULL;
extern void *ptr_ConvertU2TrusteeToSid;
void *ptr_ConvertU2TrusteeToSid = NULL;
extern void *ptr_FindEntryInSearchTable;
void *ptr_FindEntryInSearchTable = NULL;
extern void *ptr_FindSearchTableIndex;
void *ptr_FindSearchTableIndex = NULL;
extern void *ptr_FreeADsMem;
void *ptr_FreeADsMem = NULL;
extern void *ptr_FreeADsStr;
void *ptr_FreeADsStr = NULL;
extern void *ptr_FreeObjectInfo;
void *ptr_FreeObjectInfo = NULL;
extern void *ptr_GetDefaultServer;
void *ptr_GetDefaultServer = NULL;
extern void *ptr_GetDisplayName;
void *ptr_GetDisplayName = NULL;
extern void *ptr_GetDomainDNSNameForDomain;
void *ptr_GetDomainDNSNameForDomain = NULL;
extern void *ptr_GetLDAPTypeName;
void *ptr_GetLDAPTypeName = NULL;
extern void *ptr_GetServerAndPort;
void *ptr_GetServerAndPort = NULL;
extern void *ptr_GetSyntaxOfAttribute;
void *ptr_GetSyntaxOfAttribute = NULL;
extern void *ptr_InitObjectInfo;
void *ptr_InitObjectInfo = NULL;
extern void *ptr_IsGCNamespace;
void *ptr_IsGCNamespace = NULL;
extern void *ptr_LdapAddExtS;
void *ptr_LdapAddExtS = NULL;
extern void *ptr_LdapAddS;
void *ptr_LdapAddS = NULL;
extern void *ptr_LdapAttributeFree;
void *ptr_LdapAttributeFree = NULL;
extern void *ptr_LdapCacheAddRef;
void *ptr_LdapCacheAddRef = NULL;
extern void *ptr_LdapCloseObject;
void *ptr_LdapCloseObject = NULL;
extern void *ptr_LdapCompareExt;
void *ptr_LdapCompareExt = NULL;
extern void *ptr_LdapControlFree;
void *ptr_LdapControlFree = NULL;
extern void *ptr_LdapControlsFree;
void *ptr_LdapControlsFree = NULL;
extern void *ptr_LdapCountEntries;
void *ptr_LdapCountEntries = NULL;
extern void *ptr_LdapCrackUserDNtoNTLMUser2;
void *ptr_LdapCrackUserDNtoNTLMUser2 = NULL;
extern void *ptr_LdapCreatePageControl;
void *ptr_LdapCreatePageControl = NULL;
extern void *ptr_LdapDeleteExtS;
void *ptr_LdapDeleteExtS = NULL;
extern void *ptr_LdapDeleteS;
void *ptr_LdapDeleteS = NULL;
extern void *ptr_LdapFirstAttribute;
void *ptr_LdapFirstAttribute = NULL;
extern void *ptr_LdapFirstEntry;
void *ptr_LdapFirstEntry = NULL;
extern void *ptr_LdapGetDn;
void *ptr_LdapGetDn = NULL;
extern void *ptr_LdapGetNextPageS;
void *ptr_LdapGetNextPageS = NULL;
extern void *ptr_LdapGetSchemaObjectCount;
void *ptr_LdapGetSchemaObjectCount = NULL;
extern void *ptr_LdapGetSubSchemaSubEntryPath;
void *ptr_LdapGetSubSchemaSubEntryPath = NULL;
extern void *ptr_LdapGetSyntaxIdOfAttribute;
void *ptr_LdapGetSyntaxIdOfAttribute = NULL;
extern void *ptr_LdapGetSyntaxOfAttributeOnServer;
void *ptr_LdapGetSyntaxOfAttributeOnServer = NULL;
extern void *ptr_LdapGetValues;
void *ptr_LdapGetValues = NULL;
extern void *ptr_LdapGetValuesLen;
void *ptr_LdapGetValuesLen = NULL;
extern void *ptr_LdapInitializeSearchPreferences;
void *ptr_LdapInitializeSearchPreferences = NULL;
extern void *ptr_LdapIsClassNameValidOnServer;
void *ptr_LdapIsClassNameValidOnServer = NULL;
extern void *ptr_LdapMakeSchemaCacheObsolete;
void *ptr_LdapMakeSchemaCacheObsolete = NULL;
extern void *ptr_LdapMemFree;
void *ptr_LdapMemFree = NULL;
extern void *ptr_LdapModDnS;
void *ptr_LdapModDnS = NULL;
extern void *ptr_LdapModifyExtS;
void *ptr_LdapModifyExtS = NULL;
extern void *ptr_LdapModifyS;
void *ptr_LdapModifyS = NULL;
extern void *ptr_LdapMsgFree;
void *ptr_LdapMsgFree = NULL;
extern void *ptr_LdapNextAttribute;
void *ptr_LdapNextAttribute = NULL;
extern void *ptr_LdapNextEntry;
void *ptr_LdapNextEntry = NULL;
extern void *ptr_LdapOpenObject;
void *ptr_LdapOpenObject = NULL;
extern void *ptr_LdapOpenObject2;
void *ptr_LdapOpenObject2 = NULL;
extern void *ptr_LdapParsePageControl;
void *ptr_LdapParsePageControl = NULL;
extern void *ptr_LdapParseResult;
void *ptr_LdapParseResult = NULL;
extern void *ptr_LdapReadAttribute;
void *ptr_LdapReadAttribute = NULL;
extern void *ptr_LdapReadAttribute2;
void *ptr_LdapReadAttribute2 = NULL;
extern void *ptr_LdapReadAttributeFast;
void *ptr_LdapReadAttributeFast = NULL;
extern void *ptr_LdapRenameExtS;
void *ptr_LdapRenameExtS = NULL;
extern void *ptr_LdapResult;
void *ptr_LdapResult = NULL;
extern void *ptr_LdapSearch;
void *ptr_LdapSearch = NULL;
extern void *ptr_LdapSearchAbandonPage;
void *ptr_LdapSearchAbandonPage = NULL;
extern void *ptr_LdapSearchExtS;
void *ptr_LdapSearchExtS = NULL;
extern void *ptr_LdapSearchInitPage;
void *ptr_LdapSearchInitPage = NULL;
extern void *ptr_LdapSearchS;
void *ptr_LdapSearchS = NULL;
extern void *ptr_LdapSearchST;
void *ptr_LdapSearchST = NULL;
extern void *ptr_LdapTypeBinaryToString;
void *ptr_LdapTypeBinaryToString = NULL;
extern void *ptr_LdapTypeCopyConstruct;
void *ptr_LdapTypeCopyConstruct = NULL;
extern void *ptr_LdapTypeFreeLdapModList;
void *ptr_LdapTypeFreeLdapModList = NULL;
extern void *ptr_LdapTypeFreeLdapModObject;
void *ptr_LdapTypeFreeLdapModObject = NULL;
extern void *ptr_LdapTypeFreeLdapObjects;
void *ptr_LdapTypeFreeLdapObjects = NULL;
extern void *ptr_LdapTypeToAdsTypeCopyConstruct;
void *ptr_LdapTypeToAdsTypeCopyConstruct = NULL;
extern void *ptr_LdapTypeToAdsTypeDNWithBinary;
void *ptr_LdapTypeToAdsTypeDNWithBinary = NULL;
extern void *ptr_LdapTypeToAdsTypeDNWithString;
void *ptr_LdapTypeToAdsTypeDNWithString = NULL;
extern void *ptr_LdapTypeToAdsTypeGeneralizedTime;
void *ptr_LdapTypeToAdsTypeGeneralizedTime = NULL;
extern void *ptr_LdapTypeToAdsTypeUTCTime;
void *ptr_LdapTypeToAdsTypeUTCTime = NULL;
extern void *ptr_LdapValueFree;
void *ptr_LdapValueFree = NULL;
extern void *ptr_LdapValueFreeLen;
void *ptr_LdapValueFreeLen = NULL;
extern void *ptr_LdapcKeepHandleAround;
void *ptr_LdapcKeepHandleAround = NULL;
extern void *ptr_LdapcSetStickyServer;
void *ptr_LdapcSetStickyServer = NULL;
extern void *ptr_MapADSTypeToLDAPType;
void *ptr_MapADSTypeToLDAPType = NULL;
extern void *ptr_MapLDAPTypeToADSType;
void *ptr_MapLDAPTypeToADSType = NULL;
extern void *ptr_PathName;
void *ptr_PathName = NULL;
extern void *ptr_ReadPagingSupportedAttr;
void *ptr_ReadPagingSupportedAttr = NULL;
extern void *ptr_ReadSecurityDescriptorControlType;
void *ptr_ReadSecurityDescriptorControlType = NULL;
extern void *ptr_ReadServerSupportsIsADAMControl;
void *ptr_ReadServerSupportsIsADAMControl = NULL;
extern void *ptr_ReadServerSupportsIsADControl;
void *ptr_ReadServerSupportsIsADControl = NULL;
extern void *ptr_ReallocADsMem;
void *ptr_ReallocADsMem = NULL;
extern void *ptr_ReallocADsStr;
void *ptr_ReallocADsStr = NULL;
extern void *ptr_SchemaAddRef;
void *ptr_SchemaAddRef = NULL;
extern void *ptr_SchemaClose;
void *ptr_SchemaClose = NULL;
extern void *ptr_SchemaGetClassInfo;
void *ptr_SchemaGetClassInfo = NULL;
extern void *ptr_SchemaGetClassInfoByIndex;
void *ptr_SchemaGetClassInfoByIndex = NULL;
extern void *ptr_SchemaGetObjectCount;
void *ptr_SchemaGetObjectCount = NULL;
extern void *ptr_SchemaGetPropertyInfo;
void *ptr_SchemaGetPropertyInfo = NULL;
extern void *ptr_SchemaGetPropertyInfoByIndex;
void *ptr_SchemaGetPropertyInfoByIndex = NULL;
extern void *ptr_SchemaGetStringsFromStringTable;
void *ptr_SchemaGetStringsFromStringTable = NULL;
extern void *ptr_SchemaGetSyntaxOfAttribute;
void *ptr_SchemaGetSyntaxOfAttribute = NULL;
extern void *ptr_SchemaIsClassAContainer;
void *ptr_SchemaIsClassAContainer = NULL;
extern void *ptr_SchemaOpen;
void *ptr_SchemaOpen = NULL;
extern void *ptr_SortAndRemoveDuplicateOIDs;
void *ptr_SortAndRemoveDuplicateOIDs = NULL;
extern void *ptr_UnMarshallLDAPToLDAPSynID;
void *ptr_UnMarshallLDAPToLDAPSynID = NULL;
extern void *ptr_intcmp;
void *ptr_intcmp = NULL;
}


static HMODULE hModule = NULL;
static void module_init()
{    
   if (hModule) return;
   wchar_t sz_module_file[MAX_PATH];
   GetSystemDirectoryW(sz_module_file, MAX_PATH);
   wcscat_s(sz_module_file, L"\\adsldpc.dll");
   hModule = LoadLibraryW(sz_module_file);
   if (!hModule) return;

   #define __vartype(x) decltype(x)
   ptr_ADSIAbandonSearch = (__vartype(ptr_ADSIAbandonSearch))GetProcAddress(hModule, "ADSIAbandonSearch");
   ptr_ADSICloseDSObject = (__vartype(ptr_ADSICloseDSObject))GetProcAddress(hModule, "ADSICloseDSObject");
   ptr_ADSICloseSearchHandle = (__vartype(ptr_ADSICloseSearchHandle))GetProcAddress(hModule, "ADSICloseSearchHandle");
   ptr_ADSICreateDSObject = (__vartype(ptr_ADSICreateDSObject))GetProcAddress(hModule, "ADSICreateDSObject");
   ptr_ADSIDeleteDSObject = (__vartype(ptr_ADSIDeleteDSObject))GetProcAddress(hModule, "ADSIDeleteDSObject");
   ptr_ADSIExecuteSearch = (__vartype(ptr_ADSIExecuteSearch))GetProcAddress(hModule, "ADSIExecuteSearch");
   ptr_ADSIFreeColumn = (__vartype(ptr_ADSIFreeColumn))GetProcAddress(hModule, "ADSIFreeColumn");
   ptr_ADSIGetColumn = (__vartype(ptr_ADSIGetColumn))GetProcAddress(hModule, "ADSIGetColumn");
   ptr_ADSIGetFirstRow = (__vartype(ptr_ADSIGetFirstRow))GetProcAddress(hModule, "ADSIGetFirstRow");
   ptr_ADSIGetNextColumnName = (__vartype(ptr_ADSIGetNextColumnName))GetProcAddress(hModule, "ADSIGetNextColumnName");
   ptr_ADSIGetNextRow = (__vartype(ptr_ADSIGetNextRow))GetProcAddress(hModule, "ADSIGetNextRow");
   ptr_ADSIGetObjectAttributes = (__vartype(ptr_ADSIGetObjectAttributes))GetProcAddress(hModule, "ADSIGetObjectAttributes");
   ptr_ADSIGetPreviousRow = (__vartype(ptr_ADSIGetPreviousRow))GetProcAddress(hModule, "ADSIGetPreviousRow");
   ptr_ADSIModifyRdn = (__vartype(ptr_ADSIModifyRdn))GetProcAddress(hModule, "ADSIModifyRdn");
   ptr_ADSIOpenDSObject = (__vartype(ptr_ADSIOpenDSObject))GetProcAddress(hModule, "ADSIOpenDSObject");
   ptr_ADSIPrint = (__vartype(ptr_ADSIPrint))GetProcAddress(hModule, "ADSIPrint");
   ptr_ADSISetObjectAttributes = (__vartype(ptr_ADSISetObjectAttributes))GetProcAddress(hModule, "ADSISetObjectAttributes");
   ptr_ADSISetSearchPreference = (__vartype(ptr_ADSISetSearchPreference))GetProcAddress(hModule, "ADSISetSearchPreference");
   ptr_ADsAbandonSearch = (__vartype(ptr_ADsAbandonSearch))GetProcAddress(hModule, "ADsAbandonSearch");
   ptr_ADsCloseSearchHandle = (__vartype(ptr_ADsCloseSearchHandle))GetProcAddress(hModule, "ADsCloseSearchHandle");
   ptr_ADsCreateAttributeDefinition = (__vartype(ptr_ADsCreateAttributeDefinition))GetProcAddress(hModule, "ADsCreateAttributeDefinition");
   ptr_ADsCreateClassDefinition = (__vartype(ptr_ADsCreateClassDefinition))GetProcAddress(hModule, "ADsCreateClassDefinition");
   ptr_ADsCreateDSObject = (__vartype(ptr_ADsCreateDSObject))GetProcAddress(hModule, "ADsCreateDSObject");
   ptr_ADsCreateDSObjectExt = (__vartype(ptr_ADsCreateDSObjectExt))GetProcAddress(hModule, "ADsCreateDSObjectExt");
   ptr_ADsDecodeBinaryData = (__vartype(ptr_ADsDecodeBinaryData))GetProcAddress(hModule, "ADsDecodeBinaryData");
   ptr_ADsDeleteAttributeDefinition = (__vartype(ptr_ADsDeleteAttributeDefinition))GetProcAddress(hModule, "ADsDeleteAttributeDefinition");
   ptr_ADsDeleteClassDefinition = (__vartype(ptr_ADsDeleteClassDefinition))GetProcAddress(hModule, "ADsDeleteClassDefinition");
   ptr_ADsDeleteDSObject = (__vartype(ptr_ADsDeleteDSObject))GetProcAddress(hModule, "ADsDeleteDSObject");
   ptr_ADsEncodeBinaryData = (__vartype(ptr_ADsEncodeBinaryData))GetProcAddress(hModule, "ADsEncodeBinaryData");
   ptr_ADsEnumAttributes = (__vartype(ptr_ADsEnumAttributes))GetProcAddress(hModule, "ADsEnumAttributes");
   ptr_ADsEnumClasses = (__vartype(ptr_ADsEnumClasses))GetProcAddress(hModule, "ADsEnumClasses");
   ptr_ADsExecuteSearch = (__vartype(ptr_ADsExecuteSearch))GetProcAddress(hModule, "ADsExecuteSearch");
   ptr_ADsFreeColumn = (__vartype(ptr_ADsFreeColumn))GetProcAddress(hModule, "ADsFreeColumn");
   ptr_ADsGetColumn = (__vartype(ptr_ADsGetColumn))GetProcAddress(hModule, "ADsGetColumn");
   ptr_ADsGetFirstRow = (__vartype(ptr_ADsGetFirstRow))GetProcAddress(hModule, "ADsGetFirstRow");
   ptr_ADsGetLastError = (__vartype(ptr_ADsGetLastError))GetProcAddress(hModule, "ADsGetLastError");
   ptr_ADsGetNextColumnName = (__vartype(ptr_ADsGetNextColumnName))GetProcAddress(hModule, "ADsGetNextColumnName");
   ptr_ADsGetNextRow = (__vartype(ptr_ADsGetNextRow))GetProcAddress(hModule, "ADsGetNextRow");
   ptr_ADsGetObjectAttributes = (__vartype(ptr_ADsGetObjectAttributes))GetProcAddress(hModule, "ADsGetObjectAttributes");
   ptr_ADsGetPreviousRow = (__vartype(ptr_ADsGetPreviousRow))GetProcAddress(hModule, "ADsGetPreviousRow");
   ptr_ADsHelperGetCurrentRowMessage = (__vartype(ptr_ADsHelperGetCurrentRowMessage))GetProcAddress(hModule, "ADsHelperGetCurrentRowMessage");
   ptr_ADsObject = (__vartype(ptr_ADsObject))GetProcAddress(hModule, "ADsObject");
   ptr_ADsSetLastError = (__vartype(ptr_ADsSetLastError))GetProcAddress(hModule, "ADsSetLastError");
   ptr_ADsSetObjectAttributes = (__vartype(ptr_ADsSetObjectAttributes))GetProcAddress(hModule, "ADsSetObjectAttributes");
   ptr_ADsSetSearchPreference = (__vartype(ptr_ADsSetSearchPreference))GetProcAddress(hModule, "ADsSetSearchPreference");
   ptr_ADsWriteAttributeDefinition = (__vartype(ptr_ADsWriteAttributeDefinition))GetProcAddress(hModule, "ADsWriteAttributeDefinition");
   ptr_ADsWriteClassDefinition = (__vartype(ptr_ADsWriteClassDefinition))GetProcAddress(hModule, "ADsWriteClassDefinition");
   ptr_AdsTypeFreeAdsObjects = (__vartype(ptr_AdsTypeFreeAdsObjects))GetProcAddress(hModule, "AdsTypeFreeAdsObjects");
   ptr_AdsTypeToLdapTypeCopyConstruct = (__vartype(ptr_AdsTypeToLdapTypeCopyConstruct))GetProcAddress(hModule, "AdsTypeToLdapTypeCopyConstruct");
   ptr_AdsTypeToLdapTypeCopyDNWithBinary = (__vartype(ptr_AdsTypeToLdapTypeCopyDNWithBinary))GetProcAddress(hModule, "AdsTypeToLdapTypeCopyDNWithBinary");
   ptr_AdsTypeToLdapTypeCopyDNWithString = (__vartype(ptr_AdsTypeToLdapTypeCopyDNWithString))GetProcAddress(hModule, "AdsTypeToLdapTypeCopyDNWithString");
   ptr_AdsTypeToLdapTypeCopyGeneralizedTime = (__vartype(ptr_AdsTypeToLdapTypeCopyGeneralizedTime))GetProcAddress(hModule, "AdsTypeToLdapTypeCopyGeneralizedTime");
   ptr_AdsTypeToLdapTypeCopyTime = (__vartype(ptr_AdsTypeToLdapTypeCopyTime))GetProcAddress(hModule, "AdsTypeToLdapTypeCopyTime");
   ptr_AllocADsMem = (__vartype(ptr_AllocADsMem))GetProcAddress(hModule, "AllocADsMem");
   ptr_AllocADsStr = (__vartype(ptr_AllocADsStr))GetProcAddress(hModule, "AllocADsStr");
   ptr_BerBvFree = (__vartype(ptr_BerBvFree))GetProcAddress(hModule, "BerBvFree");
   ptr_BerEncodingQuotaControl = (__vartype(ptr_BerEncodingQuotaControl))GetProcAddress(hModule, "BerEncodingQuotaControl");
   ptr_BuildADsParentPath = (__vartype(ptr_BuildADsParentPath))GetProcAddress(hModule, "BuildADsParentPath");
   ptr_BuildADsParentPathFromObjectInfo = (__vartype(ptr_BuildADsParentPathFromObjectInfo))GetProcAddress(hModule, "BuildADsParentPathFromObjectInfo");
   ptr_BuildADsParentPathFromObjectInfo2 = (__vartype(ptr_BuildADsParentPathFromObjectInfo2))GetProcAddress(hModule, "BuildADsParentPathFromObjectInfo2");
   ptr_BuildADsPathFromLDAPPath = (__vartype(ptr_BuildADsPathFromLDAPPath))GetProcAddress(hModule, "BuildADsPathFromLDAPPath");
   ptr_BuildADsPathFromLDAPPath2 = (__vartype(ptr_BuildADsPathFromLDAPPath2))GetProcAddress(hModule, "BuildADsPathFromLDAPPath2");
   ptr_BuildADsPathFromParent = (__vartype(ptr_BuildADsPathFromParent))GetProcAddress(hModule, "BuildADsPathFromParent");
   ptr_BuildLDAPPathFromADsPath = (__vartype(ptr_BuildLDAPPathFromADsPath))GetProcAddress(hModule, "BuildLDAPPathFromADsPath");
   ptr_BuildLDAPPathFromADsPath2 = (__vartype(ptr_BuildLDAPPathFromADsPath2))GetProcAddress(hModule, "BuildLDAPPathFromADsPath2");
   ptr_ChangeSeparator = (__vartype(ptr_ChangeSeparator))GetProcAddress(hModule, "ChangeSeparator");
   ptr_Component = (__vartype(ptr_Component))GetProcAddress(hModule, "Component");
   ptr_ConvertSidToString = (__vartype(ptr_ConvertSidToString))GetProcAddress(hModule, "ConvertSidToString");
   ptr_ConvertSidToU2Trustee = (__vartype(ptr_ConvertSidToU2Trustee))GetProcAddress(hModule, "ConvertSidToU2Trustee");
   ptr_ConvertU2TrusteeToSid = (__vartype(ptr_ConvertU2TrusteeToSid))GetProcAddress(hModule, "ConvertU2TrusteeToSid");
   ptr_FindEntryInSearchTable = (__vartype(ptr_FindEntryInSearchTable))GetProcAddress(hModule, "FindEntryInSearchTable");
   ptr_FindSearchTableIndex = (__vartype(ptr_FindSearchTableIndex))GetProcAddress(hModule, "FindSearchTableIndex");
   ptr_FreeADsMem = (__vartype(ptr_FreeADsMem))GetProcAddress(hModule, "FreeADsMem");
   ptr_FreeADsStr = (__vartype(ptr_FreeADsStr))GetProcAddress(hModule, "FreeADsStr");
   ptr_FreeObjectInfo = (__vartype(ptr_FreeObjectInfo))GetProcAddress(hModule, "FreeObjectInfo");
   ptr_GetDefaultServer = (__vartype(ptr_GetDefaultServer))GetProcAddress(hModule, "GetDefaultServer");
   ptr_GetDisplayName = (__vartype(ptr_GetDisplayName))GetProcAddress(hModule, "GetDisplayName");
   ptr_GetDomainDNSNameForDomain = (__vartype(ptr_GetDomainDNSNameForDomain))GetProcAddress(hModule, "GetDomainDNSNameForDomain");
   ptr_GetLDAPTypeName = (__vartype(ptr_GetLDAPTypeName))GetProcAddress(hModule, "GetLDAPTypeName");
   ptr_GetServerAndPort = (__vartype(ptr_GetServerAndPort))GetProcAddress(hModule, "GetServerAndPort");
   ptr_GetSyntaxOfAttribute = (__vartype(ptr_GetSyntaxOfAttribute))GetProcAddress(hModule, "GetSyntaxOfAttribute");
   ptr_InitObjectInfo = (__vartype(ptr_InitObjectInfo))GetProcAddress(hModule, "InitObjectInfo");
   ptr_IsGCNamespace = (__vartype(ptr_IsGCNamespace))GetProcAddress(hModule, "IsGCNamespace");
   ptr_LdapAddExtS = (__vartype(ptr_LdapAddExtS))GetProcAddress(hModule, "LdapAddExtS");
   ptr_LdapAddS = (__vartype(ptr_LdapAddS))GetProcAddress(hModule, "LdapAddS");
   ptr_LdapAttributeFree = (__vartype(ptr_LdapAttributeFree))GetProcAddress(hModule, "LdapAttributeFree");
   ptr_LdapCacheAddRef = (__vartype(ptr_LdapCacheAddRef))GetProcAddress(hModule, "LdapCacheAddRef");
   ptr_LdapCloseObject = (__vartype(ptr_LdapCloseObject))GetProcAddress(hModule, "LdapCloseObject");
   ptr_LdapCompareExt = (__vartype(ptr_LdapCompareExt))GetProcAddress(hModule, "LdapCompareExt");
   ptr_LdapControlFree = (__vartype(ptr_LdapControlFree))GetProcAddress(hModule, "LdapControlFree");
   ptr_LdapControlsFree = (__vartype(ptr_LdapControlsFree))GetProcAddress(hModule, "LdapControlsFree");
   ptr_LdapCountEntries = (__vartype(ptr_LdapCountEntries))GetProcAddress(hModule, "LdapCountEntries");
   ptr_LdapCrackUserDNtoNTLMUser2 = (__vartype(ptr_LdapCrackUserDNtoNTLMUser2))GetProcAddress(hModule, "LdapCrackUserDNtoNTLMUser2");
   ptr_LdapCreatePageControl = (__vartype(ptr_LdapCreatePageControl))GetProcAddress(hModule, "LdapCreatePageControl");
   ptr_LdapDeleteExtS = (__vartype(ptr_LdapDeleteExtS))GetProcAddress(hModule, "LdapDeleteExtS");
   ptr_LdapDeleteS = (__vartype(ptr_LdapDeleteS))GetProcAddress(hModule, "LdapDeleteS");
   ptr_LdapFirstAttribute = (__vartype(ptr_LdapFirstAttribute))GetProcAddress(hModule, "LdapFirstAttribute");
   ptr_LdapFirstEntry = (__vartype(ptr_LdapFirstEntry))GetProcAddress(hModule, "LdapFirstEntry");
   ptr_LdapGetDn = (__vartype(ptr_LdapGetDn))GetProcAddress(hModule, "LdapGetDn");
   ptr_LdapGetNextPageS = (__vartype(ptr_LdapGetNextPageS))GetProcAddress(hModule, "LdapGetNextPageS");
   ptr_LdapGetSchemaObjectCount = (__vartype(ptr_LdapGetSchemaObjectCount))GetProcAddress(hModule, "LdapGetSchemaObjectCount");
   ptr_LdapGetSubSchemaSubEntryPath = (__vartype(ptr_LdapGetSubSchemaSubEntryPath))GetProcAddress(hModule, "LdapGetSubSchemaSubEntryPath");
   ptr_LdapGetSyntaxIdOfAttribute = (__vartype(ptr_LdapGetSyntaxIdOfAttribute))GetProcAddress(hModule, "LdapGetSyntaxIdOfAttribute");
   ptr_LdapGetSyntaxOfAttributeOnServer = (__vartype(ptr_LdapGetSyntaxOfAttributeOnServer))GetProcAddress(hModule, "LdapGetSyntaxOfAttributeOnServer");
   ptr_LdapGetValues = (__vartype(ptr_LdapGetValues))GetProcAddress(hModule, "LdapGetValues");
   ptr_LdapGetValuesLen = (__vartype(ptr_LdapGetValuesLen))GetProcAddress(hModule, "LdapGetValuesLen");
   ptr_LdapInitializeSearchPreferences = (__vartype(ptr_LdapInitializeSearchPreferences))GetProcAddress(hModule, "LdapInitializeSearchPreferences");
   ptr_LdapIsClassNameValidOnServer = (__vartype(ptr_LdapIsClassNameValidOnServer))GetProcAddress(hModule, "LdapIsClassNameValidOnServer");
   ptr_LdapMakeSchemaCacheObsolete = (__vartype(ptr_LdapMakeSchemaCacheObsolete))GetProcAddress(hModule, "LdapMakeSchemaCacheObsolete");
   ptr_LdapMemFree = (__vartype(ptr_LdapMemFree))GetProcAddress(hModule, "LdapMemFree");
   ptr_LdapModDnS = (__vartype(ptr_LdapModDnS))GetProcAddress(hModule, "LdapModDnS");
   ptr_LdapModifyExtS = (__vartype(ptr_LdapModifyExtS))GetProcAddress(hModule, "LdapModifyExtS");
   ptr_LdapModifyS = (__vartype(ptr_LdapModifyS))GetProcAddress(hModule, "LdapModifyS");
   ptr_LdapMsgFree = (__vartype(ptr_LdapMsgFree))GetProcAddress(hModule, "LdapMsgFree");
   ptr_LdapNextAttribute = (__vartype(ptr_LdapNextAttribute))GetProcAddress(hModule, "LdapNextAttribute");
   ptr_LdapNextEntry = (__vartype(ptr_LdapNextEntry))GetProcAddress(hModule, "LdapNextEntry");
   ptr_LdapOpenObject = (__vartype(ptr_LdapOpenObject))GetProcAddress(hModule, "LdapOpenObject");
   ptr_LdapOpenObject2 = (__vartype(ptr_LdapOpenObject2))GetProcAddress(hModule, "LdapOpenObject2");
   ptr_LdapParsePageControl = (__vartype(ptr_LdapParsePageControl))GetProcAddress(hModule, "LdapParsePageControl");
   ptr_LdapParseResult = (__vartype(ptr_LdapParseResult))GetProcAddress(hModule, "LdapParseResult");
   ptr_LdapReadAttribute = (__vartype(ptr_LdapReadAttribute))GetProcAddress(hModule, "LdapReadAttribute");
   ptr_LdapReadAttribute2 = (__vartype(ptr_LdapReadAttribute2))GetProcAddress(hModule, "LdapReadAttribute2");
   ptr_LdapReadAttributeFast = (__vartype(ptr_LdapReadAttributeFast))GetProcAddress(hModule, "LdapReadAttributeFast");
   ptr_LdapRenameExtS = (__vartype(ptr_LdapRenameExtS))GetProcAddress(hModule, "LdapRenameExtS");
   ptr_LdapResult = (__vartype(ptr_LdapResult))GetProcAddress(hModule, "LdapResult");
   ptr_LdapSearch = (__vartype(ptr_LdapSearch))GetProcAddress(hModule, "LdapSearch");
   ptr_LdapSearchAbandonPage = (__vartype(ptr_LdapSearchAbandonPage))GetProcAddress(hModule, "LdapSearchAbandonPage");
   ptr_LdapSearchExtS = (__vartype(ptr_LdapSearchExtS))GetProcAddress(hModule, "LdapSearchExtS");
   ptr_LdapSearchInitPage = (__vartype(ptr_LdapSearchInitPage))GetProcAddress(hModule, "LdapSearchInitPage");
   ptr_LdapSearchS = (__vartype(ptr_LdapSearchS))GetProcAddress(hModule, "LdapSearchS");
   ptr_LdapSearchST = (__vartype(ptr_LdapSearchST))GetProcAddress(hModule, "LdapSearchST");
   ptr_LdapTypeBinaryToString = (__vartype(ptr_LdapTypeBinaryToString))GetProcAddress(hModule, "LdapTypeBinaryToString");
   ptr_LdapTypeCopyConstruct = (__vartype(ptr_LdapTypeCopyConstruct))GetProcAddress(hModule, "LdapTypeCopyConstruct");
   ptr_LdapTypeFreeLdapModList = (__vartype(ptr_LdapTypeFreeLdapModList))GetProcAddress(hModule, "LdapTypeFreeLdapModList");
   ptr_LdapTypeFreeLdapModObject = (__vartype(ptr_LdapTypeFreeLdapModObject))GetProcAddress(hModule, "LdapTypeFreeLdapModObject");
   ptr_LdapTypeFreeLdapObjects = (__vartype(ptr_LdapTypeFreeLdapObjects))GetProcAddress(hModule, "LdapTypeFreeLdapObjects");
   ptr_LdapTypeToAdsTypeCopyConstruct = (__vartype(ptr_LdapTypeToAdsTypeCopyConstruct))GetProcAddress(hModule, "LdapTypeToAdsTypeCopyConstruct");
   ptr_LdapTypeToAdsTypeDNWithBinary = (__vartype(ptr_LdapTypeToAdsTypeDNWithBinary))GetProcAddress(hModule, "LdapTypeToAdsTypeDNWithBinary");
   ptr_LdapTypeToAdsTypeDNWithString = (__vartype(ptr_LdapTypeToAdsTypeDNWithString))GetProcAddress(hModule, "LdapTypeToAdsTypeDNWithString");
   ptr_LdapTypeToAdsTypeGeneralizedTime = (__vartype(ptr_LdapTypeToAdsTypeGeneralizedTime))GetProcAddress(hModule, "LdapTypeToAdsTypeGeneralizedTime");
   ptr_LdapTypeToAdsTypeUTCTime = (__vartype(ptr_LdapTypeToAdsTypeUTCTime))GetProcAddress(hModule, "LdapTypeToAdsTypeUTCTime");
   ptr_LdapValueFree = (__vartype(ptr_LdapValueFree))GetProcAddress(hModule, "LdapValueFree");
   ptr_LdapValueFreeLen = (__vartype(ptr_LdapValueFreeLen))GetProcAddress(hModule, "LdapValueFreeLen");
   ptr_LdapcKeepHandleAround = (__vartype(ptr_LdapcKeepHandleAround))GetProcAddress(hModule, "LdapcKeepHandleAround");
   ptr_LdapcSetStickyServer = (__vartype(ptr_LdapcSetStickyServer))GetProcAddress(hModule, "LdapcSetStickyServer");
   ptr_MapADSTypeToLDAPType = (__vartype(ptr_MapADSTypeToLDAPType))GetProcAddress(hModule, "MapADSTypeToLDAPType");
   ptr_MapLDAPTypeToADSType = (__vartype(ptr_MapLDAPTypeToADSType))GetProcAddress(hModule, "MapLDAPTypeToADSType");
   ptr_PathName = (__vartype(ptr_PathName))GetProcAddress(hModule, "PathName");
   ptr_ReadPagingSupportedAttr = (__vartype(ptr_ReadPagingSupportedAttr))GetProcAddress(hModule, "ReadPagingSupportedAttr");
   ptr_ReadSecurityDescriptorControlType = (__vartype(ptr_ReadSecurityDescriptorControlType))GetProcAddress(hModule, "ReadSecurityDescriptorControlType");
   ptr_ReadServerSupportsIsADAMControl = (__vartype(ptr_ReadServerSupportsIsADAMControl))GetProcAddress(hModule, "ReadServerSupportsIsADAMControl");
   ptr_ReadServerSupportsIsADControl = (__vartype(ptr_ReadServerSupportsIsADControl))GetProcAddress(hModule, "ReadServerSupportsIsADControl");
   ptr_ReallocADsMem = (__vartype(ptr_ReallocADsMem))GetProcAddress(hModule, "ReallocADsMem");
   ptr_ReallocADsStr = (__vartype(ptr_ReallocADsStr))GetProcAddress(hModule, "ReallocADsStr");
   ptr_SchemaAddRef = (__vartype(ptr_SchemaAddRef))GetProcAddress(hModule, "SchemaAddRef");
   ptr_SchemaClose = (__vartype(ptr_SchemaClose))GetProcAddress(hModule, "SchemaClose");
   ptr_SchemaGetClassInfo = (__vartype(ptr_SchemaGetClassInfo))GetProcAddress(hModule, "SchemaGetClassInfo");
   ptr_SchemaGetClassInfoByIndex = (__vartype(ptr_SchemaGetClassInfoByIndex))GetProcAddress(hModule, "SchemaGetClassInfoByIndex");
   ptr_SchemaGetObjectCount = (__vartype(ptr_SchemaGetObjectCount))GetProcAddress(hModule, "SchemaGetObjectCount");
   ptr_SchemaGetPropertyInfo = (__vartype(ptr_SchemaGetPropertyInfo))GetProcAddress(hModule, "SchemaGetPropertyInfo");
   ptr_SchemaGetPropertyInfoByIndex = (__vartype(ptr_SchemaGetPropertyInfoByIndex))GetProcAddress(hModule, "SchemaGetPropertyInfoByIndex");
   ptr_SchemaGetStringsFromStringTable = (__vartype(ptr_SchemaGetStringsFromStringTable))GetProcAddress(hModule, "SchemaGetStringsFromStringTable");
   ptr_SchemaGetSyntaxOfAttribute = (__vartype(ptr_SchemaGetSyntaxOfAttribute))GetProcAddress(hModule, "SchemaGetSyntaxOfAttribute");
   ptr_SchemaIsClassAContainer = (__vartype(ptr_SchemaIsClassAContainer))GetProcAddress(hModule, "SchemaIsClassAContainer");
   ptr_SchemaOpen = (__vartype(ptr_SchemaOpen))GetProcAddress(hModule, "SchemaOpen");
   ptr_SortAndRemoveDuplicateOIDs = (__vartype(ptr_SortAndRemoveDuplicateOIDs))GetProcAddress(hModule, "SortAndRemoveDuplicateOIDs");
   ptr_UnMarshallLDAPToLDAPSynID = (__vartype(ptr_UnMarshallLDAPToLDAPSynID))GetProcAddress(hModule, "UnMarshallLDAPToLDAPSynID");
   ptr_intcmp = (__vartype(ptr_intcmp))GetProcAddress(hModule, "intcmp");
   #undef __vartype
}

extern "C" BOOL __stdcall DllMain( HMODULE hModule,	DWORD ul_reason_for_call,LPVOID lpReserved)
{
	switch (ul_reason_for_call)
	{
	case DLL_PROCESS_ATTACH:
    {
        module_init();
        wchar_t tmp1[2048];
        GetModuleFileNameW(NULL, tmp1, _countof(tmp1));
        PathRemoveExtensionW(tmp1);
        wcscat(tmp1, L".hook.dll");
        LoadLibraryW(tmp1);
        break;
    }
	case DLL_PROCESS_DETACH:
		break;
	}
	return TRUE;
}

