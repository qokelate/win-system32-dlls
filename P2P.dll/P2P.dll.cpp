#include <windows.h>
#include <shlwapi.h>

extern "C" {
extern void *ptr_DllMain;
void *ptr_DllMain = NULL;
extern void *ptr_PeerCollabAddContact;
void *ptr_PeerCollabAddContact = NULL;
extern void *ptr_PeerCollabAsyncInviteContact;
void *ptr_PeerCollabAsyncInviteContact = NULL;
extern void *ptr_PeerCollabAsyncInviteEndpoint;
void *ptr_PeerCollabAsyncInviteEndpoint = NULL;
extern void *ptr_PeerCollabCancelInvitation;
void *ptr_PeerCollabCancelInvitation = NULL;
extern void *ptr_PeerCollabCloseHandle;
void *ptr_PeerCollabCloseHandle = NULL;
extern void *ptr_PeerCollabDeleteContact;
void *ptr_PeerCollabDeleteContact = NULL;
extern void *ptr_PeerCollabDeleteEndpointData;
void *ptr_PeerCollabDeleteEndpointData = NULL;
extern void *ptr_PeerCollabDeleteObject;
void *ptr_PeerCollabDeleteObject = NULL;
extern void *ptr_PeerCollabEnumApplicationRegistrationInfo;
void *ptr_PeerCollabEnumApplicationRegistrationInfo = NULL;
extern void *ptr_PeerCollabEnumApplications;
void *ptr_PeerCollabEnumApplications = NULL;
extern void *ptr_PeerCollabEnumContacts;
void *ptr_PeerCollabEnumContacts = NULL;
extern void *ptr_PeerCollabEnumEndpoints;
void *ptr_PeerCollabEnumEndpoints = NULL;
extern void *ptr_PeerCollabEnumObjects;
void *ptr_PeerCollabEnumObjects = NULL;
extern void *ptr_PeerCollabEnumPeopleNearMe;
void *ptr_PeerCollabEnumPeopleNearMe = NULL;
extern void *ptr_PeerCollabExportContact;
void *ptr_PeerCollabExportContact = NULL;
extern void *ptr_PeerCollabGetAppLaunchInfo;
void *ptr_PeerCollabGetAppLaunchInfo = NULL;
extern void *ptr_PeerCollabGetApplicationRegistrationInfo;
void *ptr_PeerCollabGetApplicationRegistrationInfo = NULL;
extern void *ptr_PeerCollabGetContact;
void *ptr_PeerCollabGetContact = NULL;
extern void *ptr_PeerCollabGetEndpointName;
void *ptr_PeerCollabGetEndpointName = NULL;
extern void *ptr_PeerCollabGetEventData;
void *ptr_PeerCollabGetEventData = NULL;
extern void *ptr_PeerCollabGetInvitationResponse;
void *ptr_PeerCollabGetInvitationResponse = NULL;
extern void *ptr_PeerCollabGetPresenceInfo;
void *ptr_PeerCollabGetPresenceInfo = NULL;
extern void *ptr_PeerCollabGetSigninOptions;
void *ptr_PeerCollabGetSigninOptions = NULL;
extern void *ptr_PeerCollabInviteContact;
void *ptr_PeerCollabInviteContact = NULL;
extern void *ptr_PeerCollabInviteEndpoint;
void *ptr_PeerCollabInviteEndpoint = NULL;
extern void *ptr_PeerCollabParseContact;
void *ptr_PeerCollabParseContact = NULL;
extern void *ptr_PeerCollabQueryContactData;
void *ptr_PeerCollabQueryContactData = NULL;
extern void *ptr_PeerCollabRefreshEndpointData;
void *ptr_PeerCollabRefreshEndpointData = NULL;
extern void *ptr_PeerCollabRegisterApplication;
void *ptr_PeerCollabRegisterApplication = NULL;
extern void *ptr_PeerCollabRegisterEvent;
void *ptr_PeerCollabRegisterEvent = NULL;
extern void *ptr_PeerCollabSetEndpointName;
void *ptr_PeerCollabSetEndpointName = NULL;
extern void *ptr_PeerCollabSetObject;
void *ptr_PeerCollabSetObject = NULL;
extern void *ptr_PeerCollabSetPresenceInfo;
void *ptr_PeerCollabSetPresenceInfo = NULL;
extern void *ptr_PeerCollabShutdown;
void *ptr_PeerCollabShutdown = NULL;
extern void *ptr_PeerCollabSignin;
void *ptr_PeerCollabSignin = NULL;
extern void *ptr_PeerCollabSignout;
void *ptr_PeerCollabSignout = NULL;
extern void *ptr_PeerCollabStartup;
void *ptr_PeerCollabStartup = NULL;
extern void *ptr_PeerCollabSubscribeEndpointData;
void *ptr_PeerCollabSubscribeEndpointData = NULL;
extern void *ptr_PeerCollabUnregisterApplication;
void *ptr_PeerCollabUnregisterApplication = NULL;
extern void *ptr_PeerCollabUnregisterEvent;
void *ptr_PeerCollabUnregisterEvent = NULL;
extern void *ptr_PeerCollabUnsubscribeEndpointData;
void *ptr_PeerCollabUnsubscribeEndpointData = NULL;
extern void *ptr_PeerCollabUpdateContact;
void *ptr_PeerCollabUpdateContact = NULL;
extern void *ptr_PeerCreatePeerName;
void *ptr_PeerCreatePeerName = NULL;
extern void *ptr_PeerEndEnumeration;
void *ptr_PeerEndEnumeration = NULL;
extern void *ptr_PeerEnumGroups;
void *ptr_PeerEnumGroups = NULL;
extern void *ptr_PeerEnumIdentities;
void *ptr_PeerEnumIdentities = NULL;
extern void *ptr_PeerFreeData;
void *ptr_PeerFreeData = NULL;
extern void *ptr_PeerGetItemCount;
void *ptr_PeerGetItemCount = NULL;
extern void *ptr_PeerGetNextItem;
void *ptr_PeerGetNextItem = NULL;
extern void *ptr_PeerGroupAddRecord;
void *ptr_PeerGroupAddRecord = NULL;
extern void *ptr_PeerGroupClose;
void *ptr_PeerGroupClose = NULL;
extern void *ptr_PeerGroupCloseDirectConnection;
void *ptr_PeerGroupCloseDirectConnection = NULL;
extern void *ptr_PeerGroupConnect;
void *ptr_PeerGroupConnect = NULL;
extern void *ptr_PeerGroupConnectByAddress;
void *ptr_PeerGroupConnectByAddress = NULL;
extern void *ptr_PeerGroupCreate;
void *ptr_PeerGroupCreate = NULL;
extern void *ptr_PeerGroupCreateInvitation;
void *ptr_PeerGroupCreateInvitation = NULL;
extern void *ptr_PeerGroupCreatePasswordInvitation;
void *ptr_PeerGroupCreatePasswordInvitation = NULL;
extern void *ptr_PeerGroupDelete;
void *ptr_PeerGroupDelete = NULL;
extern void *ptr_PeerGroupDeleteRecord;
void *ptr_PeerGroupDeleteRecord = NULL;
extern void *ptr_PeerGroupEnumConnections;
void *ptr_PeerGroupEnumConnections = NULL;
extern void *ptr_PeerGroupEnumMembers;
void *ptr_PeerGroupEnumMembers = NULL;
extern void *ptr_PeerGroupEnumRecords;
void *ptr_PeerGroupEnumRecords = NULL;
extern void *ptr_PeerGroupExportConfig;
void *ptr_PeerGroupExportConfig = NULL;
extern void *ptr_PeerGroupExportDatabase;
void *ptr_PeerGroupExportDatabase = NULL;
extern void *ptr_PeerGroupGetEventData;
void *ptr_PeerGroupGetEventData = NULL;
extern void *ptr_PeerGroupGetProperties;
void *ptr_PeerGroupGetProperties = NULL;
extern void *ptr_PeerGroupGetRecord;
void *ptr_PeerGroupGetRecord = NULL;
extern void *ptr_PeerGroupGetStatus;
void *ptr_PeerGroupGetStatus = NULL;
extern void *ptr_PeerGroupImportConfig;
void *ptr_PeerGroupImportConfig = NULL;
extern void *ptr_PeerGroupImportDatabase;
void *ptr_PeerGroupImportDatabase = NULL;
extern void *ptr_PeerGroupIssueCredentials;
void *ptr_PeerGroupIssueCredentials = NULL;
extern void *ptr_PeerGroupJoin;
void *ptr_PeerGroupJoin = NULL;
extern void *ptr_PeerGroupOpen;
void *ptr_PeerGroupOpen = NULL;
extern void *ptr_PeerGroupOpenDirectConnection;
void *ptr_PeerGroupOpenDirectConnection = NULL;
extern void *ptr_PeerGroupParseInvitation;
void *ptr_PeerGroupParseInvitation = NULL;
extern void *ptr_PeerGroupPasswordJoin;
void *ptr_PeerGroupPasswordJoin = NULL;
extern void *ptr_PeerGroupPeerTimeToUniversalTime;
void *ptr_PeerGroupPeerTimeToUniversalTime = NULL;
extern void *ptr_PeerGroupRegisterEvent;
void *ptr_PeerGroupRegisterEvent = NULL;
extern void *ptr_PeerGroupResumePasswordAuthentication;
void *ptr_PeerGroupResumePasswordAuthentication = NULL;
extern void *ptr_PeerGroupSearchRecords;
void *ptr_PeerGroupSearchRecords = NULL;
extern void *ptr_PeerGroupSendData;
void *ptr_PeerGroupSendData = NULL;
extern void *ptr_PeerGroupSetProperties;
void *ptr_PeerGroupSetProperties = NULL;
extern void *ptr_PeerGroupShutdown;
void *ptr_PeerGroupShutdown = NULL;
extern void *ptr_PeerGroupStartup;
void *ptr_PeerGroupStartup = NULL;
extern void *ptr_PeerGroupUniversalTimeToPeerTime;
void *ptr_PeerGroupUniversalTimeToPeerTime = NULL;
extern void *ptr_PeerGroupUnregisterEvent;
void *ptr_PeerGroupUnregisterEvent = NULL;
extern void *ptr_PeerGroupUpdateRecord;
void *ptr_PeerGroupUpdateRecord = NULL;
extern void *ptr_PeerHostNameToPeerName;
void *ptr_PeerHostNameToPeerName = NULL;
extern void *ptr_PeerIdentityCreate;
void *ptr_PeerIdentityCreate = NULL;
extern void *ptr_PeerIdentityDelete;
void *ptr_PeerIdentityDelete = NULL;
extern void *ptr_PeerIdentityExport;
void *ptr_PeerIdentityExport = NULL;
extern void *ptr_PeerIdentityGetCert;
void *ptr_PeerIdentityGetCert = NULL;
extern void *ptr_PeerIdentityGetCryptKey;
void *ptr_PeerIdentityGetCryptKey = NULL;
extern void *ptr_PeerIdentityGetDefault;
void *ptr_PeerIdentityGetDefault = NULL;
extern void *ptr_PeerIdentityGetFriendlyName;
void *ptr_PeerIdentityGetFriendlyName = NULL;
extern void *ptr_PeerIdentityGetXML;
void *ptr_PeerIdentityGetXML = NULL;
extern void *ptr_PeerIdentityImport;
void *ptr_PeerIdentityImport = NULL;
extern void *ptr_PeerIdentitySetFriendlyName;
void *ptr_PeerIdentitySetFriendlyName = NULL;
extern void *ptr_PeerNameToPeerHostName;
void *ptr_PeerNameToPeerHostName = NULL;
extern void *ptr_PeerPnrpEndResolve;
void *ptr_PeerPnrpEndResolve = NULL;
extern void *ptr_PeerPnrpGetCloudInfo;
void *ptr_PeerPnrpGetCloudInfo = NULL;
extern void *ptr_PeerPnrpGetEndpoint;
void *ptr_PeerPnrpGetEndpoint = NULL;
extern void *ptr_PeerPnrpRegister;
void *ptr_PeerPnrpRegister = NULL;
extern void *ptr_PeerPnrpResolve;
void *ptr_PeerPnrpResolve = NULL;
extern void *ptr_PeerPnrpShutdown;
void *ptr_PeerPnrpShutdown = NULL;
extern void *ptr_PeerPnrpStartResolve;
void *ptr_PeerPnrpStartResolve = NULL;
extern void *ptr_PeerPnrpStartup;
void *ptr_PeerPnrpStartup = NULL;
extern void *ptr_PeerPnrpUnregister;
void *ptr_PeerPnrpUnregister = NULL;
extern void *ptr_PeerPnrpUpdateRegistration;
void *ptr_PeerPnrpUpdateRegistration = NULL;
extern void *ptr_PeerSSPAddCredentials;
void *ptr_PeerSSPAddCredentials = NULL;
extern void *ptr_PeerSSPRemoveCredentials;
void *ptr_PeerSSPRemoveCredentials = NULL;
}


static HMODULE hModule = NULL;
static void module_init()
{    
   if (hModule) return;
   wchar_t sz_module_file[MAX_PATH];
   GetSystemDirectoryW(sz_module_file, MAX_PATH);
   wcscat_s(sz_module_file, L"\\P2P.dll");
   hModule = LoadLibraryW(sz_module_file);
   if (!hModule) return;

   #define __vartype(x) decltype(x)
   ptr_DllMain = (__vartype(ptr_DllMain))GetProcAddress(hModule, "DllMain");
   ptr_PeerCollabAddContact = (__vartype(ptr_PeerCollabAddContact))GetProcAddress(hModule, "PeerCollabAddContact");
   ptr_PeerCollabAsyncInviteContact = (__vartype(ptr_PeerCollabAsyncInviteContact))GetProcAddress(hModule, "PeerCollabAsyncInviteContact");
   ptr_PeerCollabAsyncInviteEndpoint = (__vartype(ptr_PeerCollabAsyncInviteEndpoint))GetProcAddress(hModule, "PeerCollabAsyncInviteEndpoint");
   ptr_PeerCollabCancelInvitation = (__vartype(ptr_PeerCollabCancelInvitation))GetProcAddress(hModule, "PeerCollabCancelInvitation");
   ptr_PeerCollabCloseHandle = (__vartype(ptr_PeerCollabCloseHandle))GetProcAddress(hModule, "PeerCollabCloseHandle");
   ptr_PeerCollabDeleteContact = (__vartype(ptr_PeerCollabDeleteContact))GetProcAddress(hModule, "PeerCollabDeleteContact");
   ptr_PeerCollabDeleteEndpointData = (__vartype(ptr_PeerCollabDeleteEndpointData))GetProcAddress(hModule, "PeerCollabDeleteEndpointData");
   ptr_PeerCollabDeleteObject = (__vartype(ptr_PeerCollabDeleteObject))GetProcAddress(hModule, "PeerCollabDeleteObject");
   ptr_PeerCollabEnumApplicationRegistrationInfo = (__vartype(ptr_PeerCollabEnumApplicationRegistrationInfo))GetProcAddress(hModule, "PeerCollabEnumApplicationRegistrationInfo");
   ptr_PeerCollabEnumApplications = (__vartype(ptr_PeerCollabEnumApplications))GetProcAddress(hModule, "PeerCollabEnumApplications");
   ptr_PeerCollabEnumContacts = (__vartype(ptr_PeerCollabEnumContacts))GetProcAddress(hModule, "PeerCollabEnumContacts");
   ptr_PeerCollabEnumEndpoints = (__vartype(ptr_PeerCollabEnumEndpoints))GetProcAddress(hModule, "PeerCollabEnumEndpoints");
   ptr_PeerCollabEnumObjects = (__vartype(ptr_PeerCollabEnumObjects))GetProcAddress(hModule, "PeerCollabEnumObjects");
   ptr_PeerCollabEnumPeopleNearMe = (__vartype(ptr_PeerCollabEnumPeopleNearMe))GetProcAddress(hModule, "PeerCollabEnumPeopleNearMe");
   ptr_PeerCollabExportContact = (__vartype(ptr_PeerCollabExportContact))GetProcAddress(hModule, "PeerCollabExportContact");
   ptr_PeerCollabGetAppLaunchInfo = (__vartype(ptr_PeerCollabGetAppLaunchInfo))GetProcAddress(hModule, "PeerCollabGetAppLaunchInfo");
   ptr_PeerCollabGetApplicationRegistrationInfo = (__vartype(ptr_PeerCollabGetApplicationRegistrationInfo))GetProcAddress(hModule, "PeerCollabGetApplicationRegistrationInfo");
   ptr_PeerCollabGetContact = (__vartype(ptr_PeerCollabGetContact))GetProcAddress(hModule, "PeerCollabGetContact");
   ptr_PeerCollabGetEndpointName = (__vartype(ptr_PeerCollabGetEndpointName))GetProcAddress(hModule, "PeerCollabGetEndpointName");
   ptr_PeerCollabGetEventData = (__vartype(ptr_PeerCollabGetEventData))GetProcAddress(hModule, "PeerCollabGetEventData");
   ptr_PeerCollabGetInvitationResponse = (__vartype(ptr_PeerCollabGetInvitationResponse))GetProcAddress(hModule, "PeerCollabGetInvitationResponse");
   ptr_PeerCollabGetPresenceInfo = (__vartype(ptr_PeerCollabGetPresenceInfo))GetProcAddress(hModule, "PeerCollabGetPresenceInfo");
   ptr_PeerCollabGetSigninOptions = (__vartype(ptr_PeerCollabGetSigninOptions))GetProcAddress(hModule, "PeerCollabGetSigninOptions");
   ptr_PeerCollabInviteContact = (__vartype(ptr_PeerCollabInviteContact))GetProcAddress(hModule, "PeerCollabInviteContact");
   ptr_PeerCollabInviteEndpoint = (__vartype(ptr_PeerCollabInviteEndpoint))GetProcAddress(hModule, "PeerCollabInviteEndpoint");
   ptr_PeerCollabParseContact = (__vartype(ptr_PeerCollabParseContact))GetProcAddress(hModule, "PeerCollabParseContact");
   ptr_PeerCollabQueryContactData = (__vartype(ptr_PeerCollabQueryContactData))GetProcAddress(hModule, "PeerCollabQueryContactData");
   ptr_PeerCollabRefreshEndpointData = (__vartype(ptr_PeerCollabRefreshEndpointData))GetProcAddress(hModule, "PeerCollabRefreshEndpointData");
   ptr_PeerCollabRegisterApplication = (__vartype(ptr_PeerCollabRegisterApplication))GetProcAddress(hModule, "PeerCollabRegisterApplication");
   ptr_PeerCollabRegisterEvent = (__vartype(ptr_PeerCollabRegisterEvent))GetProcAddress(hModule, "PeerCollabRegisterEvent");
   ptr_PeerCollabSetEndpointName = (__vartype(ptr_PeerCollabSetEndpointName))GetProcAddress(hModule, "PeerCollabSetEndpointName");
   ptr_PeerCollabSetObject = (__vartype(ptr_PeerCollabSetObject))GetProcAddress(hModule, "PeerCollabSetObject");
   ptr_PeerCollabSetPresenceInfo = (__vartype(ptr_PeerCollabSetPresenceInfo))GetProcAddress(hModule, "PeerCollabSetPresenceInfo");
   ptr_PeerCollabShutdown = (__vartype(ptr_PeerCollabShutdown))GetProcAddress(hModule, "PeerCollabShutdown");
   ptr_PeerCollabSignin = (__vartype(ptr_PeerCollabSignin))GetProcAddress(hModule, "PeerCollabSignin");
   ptr_PeerCollabSignout = (__vartype(ptr_PeerCollabSignout))GetProcAddress(hModule, "PeerCollabSignout");
   ptr_PeerCollabStartup = (__vartype(ptr_PeerCollabStartup))GetProcAddress(hModule, "PeerCollabStartup");
   ptr_PeerCollabSubscribeEndpointData = (__vartype(ptr_PeerCollabSubscribeEndpointData))GetProcAddress(hModule, "PeerCollabSubscribeEndpointData");
   ptr_PeerCollabUnregisterApplication = (__vartype(ptr_PeerCollabUnregisterApplication))GetProcAddress(hModule, "PeerCollabUnregisterApplication");
   ptr_PeerCollabUnregisterEvent = (__vartype(ptr_PeerCollabUnregisterEvent))GetProcAddress(hModule, "PeerCollabUnregisterEvent");
   ptr_PeerCollabUnsubscribeEndpointData = (__vartype(ptr_PeerCollabUnsubscribeEndpointData))GetProcAddress(hModule, "PeerCollabUnsubscribeEndpointData");
   ptr_PeerCollabUpdateContact = (__vartype(ptr_PeerCollabUpdateContact))GetProcAddress(hModule, "PeerCollabUpdateContact");
   ptr_PeerCreatePeerName = (__vartype(ptr_PeerCreatePeerName))GetProcAddress(hModule, "PeerCreatePeerName");
   ptr_PeerEndEnumeration = (__vartype(ptr_PeerEndEnumeration))GetProcAddress(hModule, "PeerEndEnumeration");
   ptr_PeerEnumGroups = (__vartype(ptr_PeerEnumGroups))GetProcAddress(hModule, "PeerEnumGroups");
   ptr_PeerEnumIdentities = (__vartype(ptr_PeerEnumIdentities))GetProcAddress(hModule, "PeerEnumIdentities");
   ptr_PeerFreeData = (__vartype(ptr_PeerFreeData))GetProcAddress(hModule, "PeerFreeData");
   ptr_PeerGetItemCount = (__vartype(ptr_PeerGetItemCount))GetProcAddress(hModule, "PeerGetItemCount");
   ptr_PeerGetNextItem = (__vartype(ptr_PeerGetNextItem))GetProcAddress(hModule, "PeerGetNextItem");
   ptr_PeerGroupAddRecord = (__vartype(ptr_PeerGroupAddRecord))GetProcAddress(hModule, "PeerGroupAddRecord");
   ptr_PeerGroupClose = (__vartype(ptr_PeerGroupClose))GetProcAddress(hModule, "PeerGroupClose");
   ptr_PeerGroupCloseDirectConnection = (__vartype(ptr_PeerGroupCloseDirectConnection))GetProcAddress(hModule, "PeerGroupCloseDirectConnection");
   ptr_PeerGroupConnect = (__vartype(ptr_PeerGroupConnect))GetProcAddress(hModule, "PeerGroupConnect");
   ptr_PeerGroupConnectByAddress = (__vartype(ptr_PeerGroupConnectByAddress))GetProcAddress(hModule, "PeerGroupConnectByAddress");
   ptr_PeerGroupCreate = (__vartype(ptr_PeerGroupCreate))GetProcAddress(hModule, "PeerGroupCreate");
   ptr_PeerGroupCreateInvitation = (__vartype(ptr_PeerGroupCreateInvitation))GetProcAddress(hModule, "PeerGroupCreateInvitation");
   ptr_PeerGroupCreatePasswordInvitation = (__vartype(ptr_PeerGroupCreatePasswordInvitation))GetProcAddress(hModule, "PeerGroupCreatePasswordInvitation");
   ptr_PeerGroupDelete = (__vartype(ptr_PeerGroupDelete))GetProcAddress(hModule, "PeerGroupDelete");
   ptr_PeerGroupDeleteRecord = (__vartype(ptr_PeerGroupDeleteRecord))GetProcAddress(hModule, "PeerGroupDeleteRecord");
   ptr_PeerGroupEnumConnections = (__vartype(ptr_PeerGroupEnumConnections))GetProcAddress(hModule, "PeerGroupEnumConnections");
   ptr_PeerGroupEnumMembers = (__vartype(ptr_PeerGroupEnumMembers))GetProcAddress(hModule, "PeerGroupEnumMembers");
   ptr_PeerGroupEnumRecords = (__vartype(ptr_PeerGroupEnumRecords))GetProcAddress(hModule, "PeerGroupEnumRecords");
   ptr_PeerGroupExportConfig = (__vartype(ptr_PeerGroupExportConfig))GetProcAddress(hModule, "PeerGroupExportConfig");
   ptr_PeerGroupExportDatabase = (__vartype(ptr_PeerGroupExportDatabase))GetProcAddress(hModule, "PeerGroupExportDatabase");
   ptr_PeerGroupGetEventData = (__vartype(ptr_PeerGroupGetEventData))GetProcAddress(hModule, "PeerGroupGetEventData");
   ptr_PeerGroupGetProperties = (__vartype(ptr_PeerGroupGetProperties))GetProcAddress(hModule, "PeerGroupGetProperties");
   ptr_PeerGroupGetRecord = (__vartype(ptr_PeerGroupGetRecord))GetProcAddress(hModule, "PeerGroupGetRecord");
   ptr_PeerGroupGetStatus = (__vartype(ptr_PeerGroupGetStatus))GetProcAddress(hModule, "PeerGroupGetStatus");
   ptr_PeerGroupImportConfig = (__vartype(ptr_PeerGroupImportConfig))GetProcAddress(hModule, "PeerGroupImportConfig");
   ptr_PeerGroupImportDatabase = (__vartype(ptr_PeerGroupImportDatabase))GetProcAddress(hModule, "PeerGroupImportDatabase");
   ptr_PeerGroupIssueCredentials = (__vartype(ptr_PeerGroupIssueCredentials))GetProcAddress(hModule, "PeerGroupIssueCredentials");
   ptr_PeerGroupJoin = (__vartype(ptr_PeerGroupJoin))GetProcAddress(hModule, "PeerGroupJoin");
   ptr_PeerGroupOpen = (__vartype(ptr_PeerGroupOpen))GetProcAddress(hModule, "PeerGroupOpen");
   ptr_PeerGroupOpenDirectConnection = (__vartype(ptr_PeerGroupOpenDirectConnection))GetProcAddress(hModule, "PeerGroupOpenDirectConnection");
   ptr_PeerGroupParseInvitation = (__vartype(ptr_PeerGroupParseInvitation))GetProcAddress(hModule, "PeerGroupParseInvitation");
   ptr_PeerGroupPasswordJoin = (__vartype(ptr_PeerGroupPasswordJoin))GetProcAddress(hModule, "PeerGroupPasswordJoin");
   ptr_PeerGroupPeerTimeToUniversalTime = (__vartype(ptr_PeerGroupPeerTimeToUniversalTime))GetProcAddress(hModule, "PeerGroupPeerTimeToUniversalTime");
   ptr_PeerGroupRegisterEvent = (__vartype(ptr_PeerGroupRegisterEvent))GetProcAddress(hModule, "PeerGroupRegisterEvent");
   ptr_PeerGroupResumePasswordAuthentication = (__vartype(ptr_PeerGroupResumePasswordAuthentication))GetProcAddress(hModule, "PeerGroupResumePasswordAuthentication");
   ptr_PeerGroupSearchRecords = (__vartype(ptr_PeerGroupSearchRecords))GetProcAddress(hModule, "PeerGroupSearchRecords");
   ptr_PeerGroupSendData = (__vartype(ptr_PeerGroupSendData))GetProcAddress(hModule, "PeerGroupSendData");
   ptr_PeerGroupSetProperties = (__vartype(ptr_PeerGroupSetProperties))GetProcAddress(hModule, "PeerGroupSetProperties");
   ptr_PeerGroupShutdown = (__vartype(ptr_PeerGroupShutdown))GetProcAddress(hModule, "PeerGroupShutdown");
   ptr_PeerGroupStartup = (__vartype(ptr_PeerGroupStartup))GetProcAddress(hModule, "PeerGroupStartup");
   ptr_PeerGroupUniversalTimeToPeerTime = (__vartype(ptr_PeerGroupUniversalTimeToPeerTime))GetProcAddress(hModule, "PeerGroupUniversalTimeToPeerTime");
   ptr_PeerGroupUnregisterEvent = (__vartype(ptr_PeerGroupUnregisterEvent))GetProcAddress(hModule, "PeerGroupUnregisterEvent");
   ptr_PeerGroupUpdateRecord = (__vartype(ptr_PeerGroupUpdateRecord))GetProcAddress(hModule, "PeerGroupUpdateRecord");
   ptr_PeerHostNameToPeerName = (__vartype(ptr_PeerHostNameToPeerName))GetProcAddress(hModule, "PeerHostNameToPeerName");
   ptr_PeerIdentityCreate = (__vartype(ptr_PeerIdentityCreate))GetProcAddress(hModule, "PeerIdentityCreate");
   ptr_PeerIdentityDelete = (__vartype(ptr_PeerIdentityDelete))GetProcAddress(hModule, "PeerIdentityDelete");
   ptr_PeerIdentityExport = (__vartype(ptr_PeerIdentityExport))GetProcAddress(hModule, "PeerIdentityExport");
   ptr_PeerIdentityGetCert = (__vartype(ptr_PeerIdentityGetCert))GetProcAddress(hModule, "PeerIdentityGetCert");
   ptr_PeerIdentityGetCryptKey = (__vartype(ptr_PeerIdentityGetCryptKey))GetProcAddress(hModule, "PeerIdentityGetCryptKey");
   ptr_PeerIdentityGetDefault = (__vartype(ptr_PeerIdentityGetDefault))GetProcAddress(hModule, "PeerIdentityGetDefault");
   ptr_PeerIdentityGetFriendlyName = (__vartype(ptr_PeerIdentityGetFriendlyName))GetProcAddress(hModule, "PeerIdentityGetFriendlyName");
   ptr_PeerIdentityGetXML = (__vartype(ptr_PeerIdentityGetXML))GetProcAddress(hModule, "PeerIdentityGetXML");
   ptr_PeerIdentityImport = (__vartype(ptr_PeerIdentityImport))GetProcAddress(hModule, "PeerIdentityImport");
   ptr_PeerIdentitySetFriendlyName = (__vartype(ptr_PeerIdentitySetFriendlyName))GetProcAddress(hModule, "PeerIdentitySetFriendlyName");
   ptr_PeerNameToPeerHostName = (__vartype(ptr_PeerNameToPeerHostName))GetProcAddress(hModule, "PeerNameToPeerHostName");
   ptr_PeerPnrpEndResolve = (__vartype(ptr_PeerPnrpEndResolve))GetProcAddress(hModule, "PeerPnrpEndResolve");
   ptr_PeerPnrpGetCloudInfo = (__vartype(ptr_PeerPnrpGetCloudInfo))GetProcAddress(hModule, "PeerPnrpGetCloudInfo");
   ptr_PeerPnrpGetEndpoint = (__vartype(ptr_PeerPnrpGetEndpoint))GetProcAddress(hModule, "PeerPnrpGetEndpoint");
   ptr_PeerPnrpRegister = (__vartype(ptr_PeerPnrpRegister))GetProcAddress(hModule, "PeerPnrpRegister");
   ptr_PeerPnrpResolve = (__vartype(ptr_PeerPnrpResolve))GetProcAddress(hModule, "PeerPnrpResolve");
   ptr_PeerPnrpShutdown = (__vartype(ptr_PeerPnrpShutdown))GetProcAddress(hModule, "PeerPnrpShutdown");
   ptr_PeerPnrpStartResolve = (__vartype(ptr_PeerPnrpStartResolve))GetProcAddress(hModule, "PeerPnrpStartResolve");
   ptr_PeerPnrpStartup = (__vartype(ptr_PeerPnrpStartup))GetProcAddress(hModule, "PeerPnrpStartup");
   ptr_PeerPnrpUnregister = (__vartype(ptr_PeerPnrpUnregister))GetProcAddress(hModule, "PeerPnrpUnregister");
   ptr_PeerPnrpUpdateRegistration = (__vartype(ptr_PeerPnrpUpdateRegistration))GetProcAddress(hModule, "PeerPnrpUpdateRegistration");
   ptr_PeerSSPAddCredentials = (__vartype(ptr_PeerSSPAddCredentials))GetProcAddress(hModule, "PeerSSPAddCredentials");
   ptr_PeerSSPRemoveCredentials = (__vartype(ptr_PeerSSPRemoveCredentials))GetProcAddress(hModule, "PeerSSPRemoveCredentials");
   #undef __vartype
}

extern "C" BOOL __stdcall DllMain( HMODULE hModule,	DWORD ul_reason_for_call,LPVOID lpReserved)
{
	switch (ul_reason_for_call)
	{
	case DLL_PROCESS_ATTACH:
    {
        module_init();
        wchar_t tmp1[2048];
        GetModuleFileNameW(NULL, tmp1, _countof(tmp1));
        PathRemoveExtensionW(tmp1);
        wcscat(tmp1, L".hook.dll");
        LoadLibraryW(tmp1);
        break;
    }
	case DLL_PROCESS_DETACH:
		break;
	}
	return TRUE;
}

