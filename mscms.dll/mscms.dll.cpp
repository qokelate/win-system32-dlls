#include <windows.h>
#include <shlwapi.h>

extern "C" {
extern void *ptr_AssociateColorProfileWithDeviceA;
void *ptr_AssociateColorProfileWithDeviceA = NULL;
extern void *ptr_AssociateColorProfileWithDeviceW;
void *ptr_AssociateColorProfileWithDeviceW = NULL;
extern void *ptr_CheckBitmapBits;
void *ptr_CheckBitmapBits = NULL;
extern void *ptr_CheckColors;
void *ptr_CheckColors = NULL;
extern void *ptr_CloseColorProfile;
void *ptr_CloseColorProfile = NULL;
extern void *ptr_CloseDisplay;
void *ptr_CloseDisplay = NULL;
extern void *ptr_ColorCplGetDefaultProfileScope;
void *ptr_ColorCplGetDefaultProfileScope = NULL;
extern void *ptr_ColorCplGetDefaultRenderingIntentScope;
void *ptr_ColorCplGetDefaultRenderingIntentScope = NULL;
extern void *ptr_ColorCplGetProfileProperties;
void *ptr_ColorCplGetProfileProperties = NULL;
extern void *ptr_ColorCplHasSystemWideAssociationListChanged;
void *ptr_ColorCplHasSystemWideAssociationListChanged = NULL;
extern void *ptr_ColorCplInitialize;
void *ptr_ColorCplInitialize = NULL;
extern void *ptr_ColorCplLoadAssociationList;
void *ptr_ColorCplLoadAssociationList = NULL;
extern void *ptr_ColorCplMergeAssociationLists;
void *ptr_ColorCplMergeAssociationLists = NULL;
extern void *ptr_ColorCplOverwritePerUserAssociationList;
void *ptr_ColorCplOverwritePerUserAssociationList = NULL;
extern void *ptr_ColorCplReleaseProfileProperties;
void *ptr_ColorCplReleaseProfileProperties = NULL;
extern void *ptr_ColorCplResetSystemWideAssociationListChangedWarning;
void *ptr_ColorCplResetSystemWideAssociationListChangedWarning = NULL;
extern void *ptr_ColorCplSaveAssociationList;
void *ptr_ColorCplSaveAssociationList = NULL;
extern void *ptr_ColorCplSetUsePerUserProfiles;
void *ptr_ColorCplSetUsePerUserProfiles = NULL;
extern void *ptr_ColorCplUninitialize;
void *ptr_ColorCplUninitialize = NULL;
extern void *ptr_ConvertColorNameToIndex;
void *ptr_ConvertColorNameToIndex = NULL;
extern void *ptr_ConvertIndexToColorName;
void *ptr_ConvertIndexToColorName = NULL;
extern void *ptr_CreateColorTransformA;
void *ptr_CreateColorTransformA = NULL;
extern void *ptr_CreateColorTransformW;
void *ptr_CreateColorTransformW = NULL;
extern void *ptr_CreateDeviceLinkProfile;
void *ptr_CreateDeviceLinkProfile = NULL;
extern void *ptr_CreateMultiProfileTransform;
void *ptr_CreateMultiProfileTransform = NULL;
extern void *ptr_CreateProfileFromLogColorSpaceA;
void *ptr_CreateProfileFromLogColorSpaceA = NULL;
extern void *ptr_CreateProfileFromLogColorSpaceW;
void *ptr_CreateProfileFromLogColorSpaceW = NULL;
extern void *ptr_DccwCreateDisplayProfileAssociationList;
void *ptr_DccwCreateDisplayProfileAssociationList = NULL;
extern void *ptr_DccwGetDisplayProfileAssociationList;
void *ptr_DccwGetDisplayProfileAssociationList = NULL;
extern void *ptr_DccwGetGamutSize;
void *ptr_DccwGetGamutSize = NULL;
extern void *ptr_DccwReleaseDisplayProfileAssociationList;
void *ptr_DccwReleaseDisplayProfileAssociationList = NULL;
extern void *ptr_DccwSetDisplayProfileAssociationList;
void *ptr_DccwSetDisplayProfileAssociationList = NULL;
extern void *ptr_DeleteColorTransform;
void *ptr_DeleteColorTransform = NULL;
extern void *ptr_DeviceRenameEvent;
void *ptr_DeviceRenameEvent = NULL;
extern void *ptr_DisassociateColorProfileFromDeviceA;
void *ptr_DisassociateColorProfileFromDeviceA = NULL;
extern void *ptr_DisassociateColorProfileFromDeviceW;
void *ptr_DisassociateColorProfileFromDeviceW = NULL;
extern void *ptr_DllCanUnloadNow;
void *ptr_DllCanUnloadNow = NULL;
extern void *ptr_DllGetClassObject;
void *ptr_DllGetClassObject = NULL;
extern void *ptr_EnumColorProfilesA;
void *ptr_EnumColorProfilesA = NULL;
extern void *ptr_EnumColorProfilesW;
void *ptr_EnumColorProfilesW = NULL;
extern void *ptr_GenerateCopyFilePaths;
void *ptr_GenerateCopyFilePaths = NULL;
extern void *ptr_GetCMMInfo;
void *ptr_GetCMMInfo = NULL;
extern void *ptr_GetColorDirectoryA;
void *ptr_GetColorDirectoryA = NULL;
extern void *ptr_GetColorDirectoryW;
void *ptr_GetColorDirectoryW = NULL;
extern void *ptr_GetColorProfileElement;
void *ptr_GetColorProfileElement = NULL;
extern void *ptr_GetColorProfileElementTag;
void *ptr_GetColorProfileElementTag = NULL;
extern void *ptr_GetColorProfileFromHandle;
void *ptr_GetColorProfileFromHandle = NULL;
extern void *ptr_GetColorProfileHeader;
void *ptr_GetColorProfileHeader = NULL;
extern void *ptr_GetCountColorProfileElements;
void *ptr_GetCountColorProfileElements = NULL;
extern void *ptr_GetNamedProfileInfo;
void *ptr_GetNamedProfileInfo = NULL;
extern void *ptr_GetPS2ColorRenderingDictionary;
void *ptr_GetPS2ColorRenderingDictionary = NULL;
extern void *ptr_GetPS2ColorRenderingIntent;
void *ptr_GetPS2ColorRenderingIntent = NULL;
extern void *ptr_GetPS2ColorSpaceArray;
void *ptr_GetPS2ColorSpaceArray = NULL;
extern void *ptr_GetStandardColorSpaceProfileA;
void *ptr_GetStandardColorSpaceProfileA = NULL;
extern void *ptr_GetStandardColorSpaceProfileW;
void *ptr_GetStandardColorSpaceProfileW = NULL;
extern void *ptr_InstallColorProfileA;
void *ptr_InstallColorProfileA = NULL;
extern void *ptr_InstallColorProfileW;
void *ptr_InstallColorProfileW = NULL;
extern void *ptr_InternalGetDeviceConfig;
void *ptr_InternalGetDeviceConfig = NULL;
extern void *ptr_InternalGetPS2CSAFromLCS;
void *ptr_InternalGetPS2CSAFromLCS = NULL;
extern void *ptr_InternalGetPS2ColorRenderingDictionary;
void *ptr_InternalGetPS2ColorRenderingDictionary = NULL;
extern void *ptr_InternalGetPS2ColorSpaceArray;
void *ptr_InternalGetPS2ColorSpaceArray = NULL;
extern void *ptr_InternalGetPS2PreviewCRD;
void *ptr_InternalGetPS2PreviewCRD = NULL;
extern void *ptr_InternalRefreshCalibration;
void *ptr_InternalRefreshCalibration = NULL;
extern void *ptr_InternalSetDeviceConfig;
void *ptr_InternalSetDeviceConfig = NULL;
extern void *ptr_InternalWcsAssociateColorProfileWithDevice;
void *ptr_InternalWcsAssociateColorProfileWithDevice = NULL;
extern void *ptr_IsColorProfileTagPresent;
void *ptr_IsColorProfileTagPresent = NULL;
extern void *ptr_IsColorProfileValid;
void *ptr_IsColorProfileValid = NULL;
extern void *ptr_OpenColorProfileA;
void *ptr_OpenColorProfileA = NULL;
extern void *ptr_OpenColorProfileW;
void *ptr_OpenColorProfileW = NULL;
extern void *ptr_OpenDisplay;
void *ptr_OpenDisplay = NULL;
extern void *ptr_RegisterCMMA;
void *ptr_RegisterCMMA = NULL;
extern void *ptr_RegisterCMMW;
void *ptr_RegisterCMMW = NULL;
extern void *ptr_SelectCMM;
void *ptr_SelectCMM = NULL;
extern void *ptr_SetColorProfileElement;
void *ptr_SetColorProfileElement = NULL;
extern void *ptr_SetColorProfileElementReference;
void *ptr_SetColorProfileElementReference = NULL;
extern void *ptr_SetColorProfileElementSize;
void *ptr_SetColorProfileElementSize = NULL;
extern void *ptr_SetColorProfileHeader;
void *ptr_SetColorProfileHeader = NULL;
extern void *ptr_SetStandardColorSpaceProfileA;
void *ptr_SetStandardColorSpaceProfileA = NULL;
extern void *ptr_SetStandardColorSpaceProfileW;
void *ptr_SetStandardColorSpaceProfileW = NULL;
extern void *ptr_SpoolerCopyFileEvent;
void *ptr_SpoolerCopyFileEvent = NULL;
extern void *ptr_TranslateBitmapBits;
void *ptr_TranslateBitmapBits = NULL;
extern void *ptr_TranslateColors;
void *ptr_TranslateColors = NULL;
extern void *ptr_UninstallColorProfileA;
void *ptr_UninstallColorProfileA = NULL;
extern void *ptr_UninstallColorProfileW;
void *ptr_UninstallColorProfileW = NULL;
extern void *ptr_UnregisterCMMA;
void *ptr_UnregisterCMMA = NULL;
extern void *ptr_UnregisterCMMW;
void *ptr_UnregisterCMMW = NULL;
extern void *ptr_WcsAssociateColorProfileWithDevice;
void *ptr_WcsAssociateColorProfileWithDevice = NULL;
extern void *ptr_WcsCheckColors;
void *ptr_WcsCheckColors = NULL;
extern void *ptr_WcsCreateIccProfile;
void *ptr_WcsCreateIccProfile = NULL;
extern void *ptr_WcsDisassociateColorProfileFromDevice;
void *ptr_WcsDisassociateColorProfileFromDevice = NULL;
extern void *ptr_WcsEnumColorProfiles;
void *ptr_WcsEnumColorProfiles = NULL;
extern void *ptr_WcsEnumColorProfilesSize;
void *ptr_WcsEnumColorProfilesSize = NULL;
extern void *ptr_WcsGetCalibrationManagementState;
void *ptr_WcsGetCalibrationManagementState = NULL;
extern void *ptr_WcsGetDefaultColorProfile;
void *ptr_WcsGetDefaultColorProfile = NULL;
extern void *ptr_WcsGetDefaultColorProfileSize;
void *ptr_WcsGetDefaultColorProfileSize = NULL;
extern void *ptr_WcsGetDefaultRenderingIntent;
void *ptr_WcsGetDefaultRenderingIntent = NULL;
extern void *ptr_WcsGetUsePerUserProfiles;
void *ptr_WcsGetUsePerUserProfiles = NULL;
extern void *ptr_WcsGpCanInstallOrUninstallProfiles;
void *ptr_WcsGpCanInstallOrUninstallProfiles = NULL;
extern void *ptr_WcsOpenColorProfileA;
void *ptr_WcsOpenColorProfileA = NULL;
extern void *ptr_WcsOpenColorProfileW;
void *ptr_WcsOpenColorProfileW = NULL;
extern void *ptr_WcsSetCalibrationManagementState;
void *ptr_WcsSetCalibrationManagementState = NULL;
extern void *ptr_WcsSetDefaultColorProfile;
void *ptr_WcsSetDefaultColorProfile = NULL;
extern void *ptr_WcsSetDefaultRenderingIntent;
void *ptr_WcsSetDefaultRenderingIntent = NULL;
extern void *ptr_WcsSetUsePerUserProfiles;
void *ptr_WcsSetUsePerUserProfiles = NULL;
extern void *ptr_WcsTranslateColors;
void *ptr_WcsTranslateColors = NULL;
}


static HMODULE hModule = NULL;
static void module_init()
{    
   if (hModule) return;
   wchar_t sz_module_file[MAX_PATH];
   GetSystemDirectoryW(sz_module_file, MAX_PATH);
   wcscat_s(sz_module_file, L"\\mscms.dll");
   hModule = LoadLibraryW(sz_module_file);
   if (!hModule) return;

   #define __vartype(x) decltype(x)
   ptr_AssociateColorProfileWithDeviceA = (__vartype(ptr_AssociateColorProfileWithDeviceA))GetProcAddress(hModule, "AssociateColorProfileWithDeviceA");
   ptr_AssociateColorProfileWithDeviceW = (__vartype(ptr_AssociateColorProfileWithDeviceW))GetProcAddress(hModule, "AssociateColorProfileWithDeviceW");
   ptr_CheckBitmapBits = (__vartype(ptr_CheckBitmapBits))GetProcAddress(hModule, "CheckBitmapBits");
   ptr_CheckColors = (__vartype(ptr_CheckColors))GetProcAddress(hModule, "CheckColors");
   ptr_CloseColorProfile = (__vartype(ptr_CloseColorProfile))GetProcAddress(hModule, "CloseColorProfile");
   ptr_CloseDisplay = (__vartype(ptr_CloseDisplay))GetProcAddress(hModule, "CloseDisplay");
   ptr_ColorCplGetDefaultProfileScope = (__vartype(ptr_ColorCplGetDefaultProfileScope))GetProcAddress(hModule, "ColorCplGetDefaultProfileScope");
   ptr_ColorCplGetDefaultRenderingIntentScope = (__vartype(ptr_ColorCplGetDefaultRenderingIntentScope))GetProcAddress(hModule, "ColorCplGetDefaultRenderingIntentScope");
   ptr_ColorCplGetProfileProperties = (__vartype(ptr_ColorCplGetProfileProperties))GetProcAddress(hModule, "ColorCplGetProfileProperties");
   ptr_ColorCplHasSystemWideAssociationListChanged = (__vartype(ptr_ColorCplHasSystemWideAssociationListChanged))GetProcAddress(hModule, "ColorCplHasSystemWideAssociationListChanged");
   ptr_ColorCplInitialize = (__vartype(ptr_ColorCplInitialize))GetProcAddress(hModule, "ColorCplInitialize");
   ptr_ColorCplLoadAssociationList = (__vartype(ptr_ColorCplLoadAssociationList))GetProcAddress(hModule, "ColorCplLoadAssociationList");
   ptr_ColorCplMergeAssociationLists = (__vartype(ptr_ColorCplMergeAssociationLists))GetProcAddress(hModule, "ColorCplMergeAssociationLists");
   ptr_ColorCplOverwritePerUserAssociationList = (__vartype(ptr_ColorCplOverwritePerUserAssociationList))GetProcAddress(hModule, "ColorCplOverwritePerUserAssociationList");
   ptr_ColorCplReleaseProfileProperties = (__vartype(ptr_ColorCplReleaseProfileProperties))GetProcAddress(hModule, "ColorCplReleaseProfileProperties");
   ptr_ColorCplResetSystemWideAssociationListChangedWarning = (__vartype(ptr_ColorCplResetSystemWideAssociationListChangedWarning))GetProcAddress(hModule, "ColorCplResetSystemWideAssociationListChangedWarning");
   ptr_ColorCplSaveAssociationList = (__vartype(ptr_ColorCplSaveAssociationList))GetProcAddress(hModule, "ColorCplSaveAssociationList");
   ptr_ColorCplSetUsePerUserProfiles = (__vartype(ptr_ColorCplSetUsePerUserProfiles))GetProcAddress(hModule, "ColorCplSetUsePerUserProfiles");
   ptr_ColorCplUninitialize = (__vartype(ptr_ColorCplUninitialize))GetProcAddress(hModule, "ColorCplUninitialize");
   ptr_ConvertColorNameToIndex = (__vartype(ptr_ConvertColorNameToIndex))GetProcAddress(hModule, "ConvertColorNameToIndex");
   ptr_ConvertIndexToColorName = (__vartype(ptr_ConvertIndexToColorName))GetProcAddress(hModule, "ConvertIndexToColorName");
   ptr_CreateColorTransformA = (__vartype(ptr_CreateColorTransformA))GetProcAddress(hModule, "CreateColorTransformA");
   ptr_CreateColorTransformW = (__vartype(ptr_CreateColorTransformW))GetProcAddress(hModule, "CreateColorTransformW");
   ptr_CreateDeviceLinkProfile = (__vartype(ptr_CreateDeviceLinkProfile))GetProcAddress(hModule, "CreateDeviceLinkProfile");
   ptr_CreateMultiProfileTransform = (__vartype(ptr_CreateMultiProfileTransform))GetProcAddress(hModule, "CreateMultiProfileTransform");
   ptr_CreateProfileFromLogColorSpaceA = (__vartype(ptr_CreateProfileFromLogColorSpaceA))GetProcAddress(hModule, "CreateProfileFromLogColorSpaceA");
   ptr_CreateProfileFromLogColorSpaceW = (__vartype(ptr_CreateProfileFromLogColorSpaceW))GetProcAddress(hModule, "CreateProfileFromLogColorSpaceW");
   ptr_DccwCreateDisplayProfileAssociationList = (__vartype(ptr_DccwCreateDisplayProfileAssociationList))GetProcAddress(hModule, "DccwCreateDisplayProfileAssociationList");
   ptr_DccwGetDisplayProfileAssociationList = (__vartype(ptr_DccwGetDisplayProfileAssociationList))GetProcAddress(hModule, "DccwGetDisplayProfileAssociationList");
   ptr_DccwGetGamutSize = (__vartype(ptr_DccwGetGamutSize))GetProcAddress(hModule, "DccwGetGamutSize");
   ptr_DccwReleaseDisplayProfileAssociationList = (__vartype(ptr_DccwReleaseDisplayProfileAssociationList))GetProcAddress(hModule, "DccwReleaseDisplayProfileAssociationList");
   ptr_DccwSetDisplayProfileAssociationList = (__vartype(ptr_DccwSetDisplayProfileAssociationList))GetProcAddress(hModule, "DccwSetDisplayProfileAssociationList");
   ptr_DeleteColorTransform = (__vartype(ptr_DeleteColorTransform))GetProcAddress(hModule, "DeleteColorTransform");
   ptr_DeviceRenameEvent = (__vartype(ptr_DeviceRenameEvent))GetProcAddress(hModule, "DeviceRenameEvent");
   ptr_DisassociateColorProfileFromDeviceA = (__vartype(ptr_DisassociateColorProfileFromDeviceA))GetProcAddress(hModule, "DisassociateColorProfileFromDeviceA");
   ptr_DisassociateColorProfileFromDeviceW = (__vartype(ptr_DisassociateColorProfileFromDeviceW))GetProcAddress(hModule, "DisassociateColorProfileFromDeviceW");
   ptr_DllCanUnloadNow = (__vartype(ptr_DllCanUnloadNow))GetProcAddress(hModule, "DllCanUnloadNow");
   ptr_DllGetClassObject = (__vartype(ptr_DllGetClassObject))GetProcAddress(hModule, "DllGetClassObject");
   ptr_EnumColorProfilesA = (__vartype(ptr_EnumColorProfilesA))GetProcAddress(hModule, "EnumColorProfilesA");
   ptr_EnumColorProfilesW = (__vartype(ptr_EnumColorProfilesW))GetProcAddress(hModule, "EnumColorProfilesW");
   ptr_GenerateCopyFilePaths = (__vartype(ptr_GenerateCopyFilePaths))GetProcAddress(hModule, "GenerateCopyFilePaths");
   ptr_GetCMMInfo = (__vartype(ptr_GetCMMInfo))GetProcAddress(hModule, "GetCMMInfo");
   ptr_GetColorDirectoryA = (__vartype(ptr_GetColorDirectoryA))GetProcAddress(hModule, "GetColorDirectoryA");
   ptr_GetColorDirectoryW = (__vartype(ptr_GetColorDirectoryW))GetProcAddress(hModule, "GetColorDirectoryW");
   ptr_GetColorProfileElement = (__vartype(ptr_GetColorProfileElement))GetProcAddress(hModule, "GetColorProfileElement");
   ptr_GetColorProfileElementTag = (__vartype(ptr_GetColorProfileElementTag))GetProcAddress(hModule, "GetColorProfileElementTag");
   ptr_GetColorProfileFromHandle = (__vartype(ptr_GetColorProfileFromHandle))GetProcAddress(hModule, "GetColorProfileFromHandle");
   ptr_GetColorProfileHeader = (__vartype(ptr_GetColorProfileHeader))GetProcAddress(hModule, "GetColorProfileHeader");
   ptr_GetCountColorProfileElements = (__vartype(ptr_GetCountColorProfileElements))GetProcAddress(hModule, "GetCountColorProfileElements");
   ptr_GetNamedProfileInfo = (__vartype(ptr_GetNamedProfileInfo))GetProcAddress(hModule, "GetNamedProfileInfo");
   ptr_GetPS2ColorRenderingDictionary = (__vartype(ptr_GetPS2ColorRenderingDictionary))GetProcAddress(hModule, "GetPS2ColorRenderingDictionary");
   ptr_GetPS2ColorRenderingIntent = (__vartype(ptr_GetPS2ColorRenderingIntent))GetProcAddress(hModule, "GetPS2ColorRenderingIntent");
   ptr_GetPS2ColorSpaceArray = (__vartype(ptr_GetPS2ColorSpaceArray))GetProcAddress(hModule, "GetPS2ColorSpaceArray");
   ptr_GetStandardColorSpaceProfileA = (__vartype(ptr_GetStandardColorSpaceProfileA))GetProcAddress(hModule, "GetStandardColorSpaceProfileA");
   ptr_GetStandardColorSpaceProfileW = (__vartype(ptr_GetStandardColorSpaceProfileW))GetProcAddress(hModule, "GetStandardColorSpaceProfileW");
   ptr_InstallColorProfileA = (__vartype(ptr_InstallColorProfileA))GetProcAddress(hModule, "InstallColorProfileA");
   ptr_InstallColorProfileW = (__vartype(ptr_InstallColorProfileW))GetProcAddress(hModule, "InstallColorProfileW");
   ptr_InternalGetDeviceConfig = (__vartype(ptr_InternalGetDeviceConfig))GetProcAddress(hModule, "InternalGetDeviceConfig");
   ptr_InternalGetPS2CSAFromLCS = (__vartype(ptr_InternalGetPS2CSAFromLCS))GetProcAddress(hModule, "InternalGetPS2CSAFromLCS");
   ptr_InternalGetPS2ColorRenderingDictionary = (__vartype(ptr_InternalGetPS2ColorRenderingDictionary))GetProcAddress(hModule, "InternalGetPS2ColorRenderingDictionary");
   ptr_InternalGetPS2ColorSpaceArray = (__vartype(ptr_InternalGetPS2ColorSpaceArray))GetProcAddress(hModule, "InternalGetPS2ColorSpaceArray");
   ptr_InternalGetPS2PreviewCRD = (__vartype(ptr_InternalGetPS2PreviewCRD))GetProcAddress(hModule, "InternalGetPS2PreviewCRD");
   ptr_InternalRefreshCalibration = (__vartype(ptr_InternalRefreshCalibration))GetProcAddress(hModule, "InternalRefreshCalibration");
   ptr_InternalSetDeviceConfig = (__vartype(ptr_InternalSetDeviceConfig))GetProcAddress(hModule, "InternalSetDeviceConfig");
   ptr_InternalWcsAssociateColorProfileWithDevice = (__vartype(ptr_InternalWcsAssociateColorProfileWithDevice))GetProcAddress(hModule, "InternalWcsAssociateColorProfileWithDevice");
   ptr_IsColorProfileTagPresent = (__vartype(ptr_IsColorProfileTagPresent))GetProcAddress(hModule, "IsColorProfileTagPresent");
   ptr_IsColorProfileValid = (__vartype(ptr_IsColorProfileValid))GetProcAddress(hModule, "IsColorProfileValid");
   ptr_OpenColorProfileA = (__vartype(ptr_OpenColorProfileA))GetProcAddress(hModule, "OpenColorProfileA");
   ptr_OpenColorProfileW = (__vartype(ptr_OpenColorProfileW))GetProcAddress(hModule, "OpenColorProfileW");
   ptr_OpenDisplay = (__vartype(ptr_OpenDisplay))GetProcAddress(hModule, "OpenDisplay");
   ptr_RegisterCMMA = (__vartype(ptr_RegisterCMMA))GetProcAddress(hModule, "RegisterCMMA");
   ptr_RegisterCMMW = (__vartype(ptr_RegisterCMMW))GetProcAddress(hModule, "RegisterCMMW");
   ptr_SelectCMM = (__vartype(ptr_SelectCMM))GetProcAddress(hModule, "SelectCMM");
   ptr_SetColorProfileElement = (__vartype(ptr_SetColorProfileElement))GetProcAddress(hModule, "SetColorProfileElement");
   ptr_SetColorProfileElementReference = (__vartype(ptr_SetColorProfileElementReference))GetProcAddress(hModule, "SetColorProfileElementReference");
   ptr_SetColorProfileElementSize = (__vartype(ptr_SetColorProfileElementSize))GetProcAddress(hModule, "SetColorProfileElementSize");
   ptr_SetColorProfileHeader = (__vartype(ptr_SetColorProfileHeader))GetProcAddress(hModule, "SetColorProfileHeader");
   ptr_SetStandardColorSpaceProfileA = (__vartype(ptr_SetStandardColorSpaceProfileA))GetProcAddress(hModule, "SetStandardColorSpaceProfileA");
   ptr_SetStandardColorSpaceProfileW = (__vartype(ptr_SetStandardColorSpaceProfileW))GetProcAddress(hModule, "SetStandardColorSpaceProfileW");
   ptr_SpoolerCopyFileEvent = (__vartype(ptr_SpoolerCopyFileEvent))GetProcAddress(hModule, "SpoolerCopyFileEvent");
   ptr_TranslateBitmapBits = (__vartype(ptr_TranslateBitmapBits))GetProcAddress(hModule, "TranslateBitmapBits");
   ptr_TranslateColors = (__vartype(ptr_TranslateColors))GetProcAddress(hModule, "TranslateColors");
   ptr_UninstallColorProfileA = (__vartype(ptr_UninstallColorProfileA))GetProcAddress(hModule, "UninstallColorProfileA");
   ptr_UninstallColorProfileW = (__vartype(ptr_UninstallColorProfileW))GetProcAddress(hModule, "UninstallColorProfileW");
   ptr_UnregisterCMMA = (__vartype(ptr_UnregisterCMMA))GetProcAddress(hModule, "UnregisterCMMA");
   ptr_UnregisterCMMW = (__vartype(ptr_UnregisterCMMW))GetProcAddress(hModule, "UnregisterCMMW");
   ptr_WcsAssociateColorProfileWithDevice = (__vartype(ptr_WcsAssociateColorProfileWithDevice))GetProcAddress(hModule, "WcsAssociateColorProfileWithDevice");
   ptr_WcsCheckColors = (__vartype(ptr_WcsCheckColors))GetProcAddress(hModule, "WcsCheckColors");
   ptr_WcsCreateIccProfile = (__vartype(ptr_WcsCreateIccProfile))GetProcAddress(hModule, "WcsCreateIccProfile");
   ptr_WcsDisassociateColorProfileFromDevice = (__vartype(ptr_WcsDisassociateColorProfileFromDevice))GetProcAddress(hModule, "WcsDisassociateColorProfileFromDevice");
   ptr_WcsEnumColorProfiles = (__vartype(ptr_WcsEnumColorProfiles))GetProcAddress(hModule, "WcsEnumColorProfiles");
   ptr_WcsEnumColorProfilesSize = (__vartype(ptr_WcsEnumColorProfilesSize))GetProcAddress(hModule, "WcsEnumColorProfilesSize");
   ptr_WcsGetCalibrationManagementState = (__vartype(ptr_WcsGetCalibrationManagementState))GetProcAddress(hModule, "WcsGetCalibrationManagementState");
   ptr_WcsGetDefaultColorProfile = (__vartype(ptr_WcsGetDefaultColorProfile))GetProcAddress(hModule, "WcsGetDefaultColorProfile");
   ptr_WcsGetDefaultColorProfileSize = (__vartype(ptr_WcsGetDefaultColorProfileSize))GetProcAddress(hModule, "WcsGetDefaultColorProfileSize");
   ptr_WcsGetDefaultRenderingIntent = (__vartype(ptr_WcsGetDefaultRenderingIntent))GetProcAddress(hModule, "WcsGetDefaultRenderingIntent");
   ptr_WcsGetUsePerUserProfiles = (__vartype(ptr_WcsGetUsePerUserProfiles))GetProcAddress(hModule, "WcsGetUsePerUserProfiles");
   ptr_WcsGpCanInstallOrUninstallProfiles = (__vartype(ptr_WcsGpCanInstallOrUninstallProfiles))GetProcAddress(hModule, "WcsGpCanInstallOrUninstallProfiles");
   ptr_WcsOpenColorProfileA = (__vartype(ptr_WcsOpenColorProfileA))GetProcAddress(hModule, "WcsOpenColorProfileA");
   ptr_WcsOpenColorProfileW = (__vartype(ptr_WcsOpenColorProfileW))GetProcAddress(hModule, "WcsOpenColorProfileW");
   ptr_WcsSetCalibrationManagementState = (__vartype(ptr_WcsSetCalibrationManagementState))GetProcAddress(hModule, "WcsSetCalibrationManagementState");
   ptr_WcsSetDefaultColorProfile = (__vartype(ptr_WcsSetDefaultColorProfile))GetProcAddress(hModule, "WcsSetDefaultColorProfile");
   ptr_WcsSetDefaultRenderingIntent = (__vartype(ptr_WcsSetDefaultRenderingIntent))GetProcAddress(hModule, "WcsSetDefaultRenderingIntent");
   ptr_WcsSetUsePerUserProfiles = (__vartype(ptr_WcsSetUsePerUserProfiles))GetProcAddress(hModule, "WcsSetUsePerUserProfiles");
   ptr_WcsTranslateColors = (__vartype(ptr_WcsTranslateColors))GetProcAddress(hModule, "WcsTranslateColors");
   #undef __vartype
}

extern "C" BOOL __stdcall DllMain( HMODULE hModule,	DWORD ul_reason_for_call,LPVOID lpReserved)
{
	switch (ul_reason_for_call)
	{
	case DLL_PROCESS_ATTACH:
    {
        module_init();
        wchar_t tmp1[2048];
        GetModuleFileNameW(NULL, tmp1, _countof(tmp1));
        PathRemoveExtensionW(tmp1);
        wcscat(tmp1, L".hook.dll");
        LoadLibraryW(tmp1);
        break;
    }
	case DLL_PROCESS_DETACH:
		break;
	}
	return TRUE;
}

